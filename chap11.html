
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Multiple Regression &#8212; Think Stats, 3rd edition</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]]}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chap11';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Time Series Analysis" href="chap12.html" />
    <link rel="prev" title="Least Squares" href="chap10.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">Think Stats, 3rd edition</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    Think Stats, 3rd edition
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="chap00.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap01.html">Exploratory Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap02.html">Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap03.html">Probability Mass Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap04.html">Cumulative Distribution Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap05.html">Modeling Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap06.html">Probability Density Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap07.html">Relationships between variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap08.html">Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap09.html">Hypothesis Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap10.html">Least Squares</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Multiple Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap12.html">Time Series Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap13.html">Survival analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap14.html">Analytic Methods</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/AllenDowney/ThinkStats/tree/v3" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/chap11.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Multiple Regression</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#statsmodels">StatsModels</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#on-to-multiple-regression">On To Multiple Regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#control-variables">Control Variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nonlinear-relationships">Nonlinear Relationships</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#logistic-regression">Logistic Regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#glossary">Glossary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-11-1">Exercise 11.1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-11-2">Exercise 11.2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-11-3">Exercise 11.3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-11-4">Exercise 11.4</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p>The third edition of <em>Think Stats</em> is available now from <a class="reference external" href="https://bookshop.org/a/98697/9781098190255">Bookshop.org</a> and <a class="reference external" href="https://amzn.to/42lmxwu">Amazon</a> (those are affiliate links). If you are enjoying the free, online version, consider <a class="reference external" href="https://buymeacoffee.com/allendowney">buying me a coffee</a>.</p>
<section id="multiple-regression">
<h1>Multiple Regression<a class="headerlink" href="#multiple-regression" title="Link to this heading">#</a></h1>
<p>The linear least squares fit in the previous chapter is an example of <strong>regression</strong>, which is the more general problem of modeling the relationship between one set of variables, called <strong>response variables</strong> or dependent variables, and another set of variables, called <strong>explanatory variables</strong> or independent variables.</p>
<p>In the examples in the previous chapter, there is only one response variable and one explanatory variable, which is called <strong>simple regression</strong>.
In this chapter, we move on to <strong>multiple regression</strong>, with more than one explanatory variable, but still only one response variable.
If there is more than one response variable, that’s multivariate regression, which we won’t cover in this book.</p>
<p><a class="reference external" href="https://colab.research.google.com/github/AllenDowney/ThinkStats/blob/v3/nb/chap11.ipynb">Click here to run this notebook on Colab</a>.</p>
<div class="cell tag_remove-print tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">os.path</span><span class="w"> </span><span class="kn">import</span> <span class="n">basename</span><span class="p">,</span> <span class="n">exists</span>


<span class="k">def</span><span class="w"> </span><span class="nf">download</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">urllib.request</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlretrieve</span>

        <span class="n">local</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloaded &quot;</span> <span class="o">+</span> <span class="n">local</span><span class="p">)</span>


<span class="n">download</span><span class="p">(</span><span class="s2">&quot;https://github.com/AllenDowney/ThinkStats/raw/v3/nb/thinkstats.py&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_remove-print tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">empiricaldist</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="o">%</span><span class="k">pip</span> install empiricaldist
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_remove-print tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">thinkstats</span><span class="w"> </span><span class="kn">import</span> <span class="n">decorate</span>
</pre></div>
</div>
</div>
</details>
</div>
<section id="statsmodels">
<h2>StatsModels<a class="headerlink" href="#statsmodels" title="Link to this heading">#</a></h2>
<p>In the previous chapter we used the SciPy function <code class="docutils literal notranslate"><span class="pre">linregress</span></code> to compute least squares fits.
This function performs simple regression, but not multiple regression.
For that, we’ll use <code class="docutils literal notranslate"><span class="pre">StatsModels</span></code>, a package that provides several forms of regression and other analyses.</p>
<p>As an first example, we’ll continue exploring the penguin data.</p>
<p>The following cell downloads the data from a repository created by Allison Horst.</p>
<p>Horst AM, Hill AP, Gorman KB (2020). palmerpenguins: Palmer Archipelago (Antarctica) penguin data. R package version 0.1.0. <a class="reference external" href="https://allisonhorst.github.io/palmerpenguins/">https://allisonhorst.github.io/palmerpenguins/</a>. doi: 10.5281/zenodo.3960218.</p>
<p>The data was collected as part of the research that led to this paper: Gorman KB, Williams TD, Fraser WR (2014). Ecological sexual dimorphism and environmental variability within a community of Antarctic penguins (genus Pygoscelis). PLoS ONE 9(3):e90081. <a class="reference external" href="https://doi.org/10.1371/journal.pone.0090081">https://doi.org/10.1371/journal.pone.0090081</a></p>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">download</span><span class="p">(</span>
    <span class="s2">&quot;https://raw.githubusercontent.com/allisonhorst/palmerpenguins/c19a904462482430170bfe2c718775ddb7dbb885/inst/extdata/penguins_raw.csv&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>When we load the data, we’ll use the following dictionary to give the columns names that don’t contain spaces, which will make them easier to use with StatsModels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Body Mass (g)&quot;</span><span class="p">:</span> <span class="s2">&quot;mass&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Flipper Length (mm)&quot;</span><span class="p">:</span> <span class="s2">&quot;flipper_length&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Culmen Length (mm)&quot;</span><span class="p">:</span> <span class="s2">&quot;culmen_length&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Culmen Depth (mm)&quot;</span><span class="p">:</span> <span class="s2">&quot;culmen_depth&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can load the data, drop the rows with missing mass, and rename the columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">penguins</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;penguins_raw.csv&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Body Mass (g)&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">penguins</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(342, 17)
</pre></div>
</div>
</div>
</div>
<p>The dataset contains three species of penguins.
We’ll work with just the Adélie penguins.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adelie</span> <span class="o">=</span> <span class="n">penguins</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;Species.str.startswith(&quot;Adelie&quot;)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="nb">len</span><span class="p">(</span><span class="n">adelie</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>151
</pre></div>
</div>
</div>
</div>
<p>In the previous chapter, we computed a least squares fit between the penguins’ flipper lengths and weights.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flipper_length</span> <span class="o">=</span> <span class="n">adelie</span><span class="p">[</span><span class="s2">&quot;flipper_length&quot;</span><span class="p">]</span>
<span class="n">body_mass</span> <span class="o">=</span> <span class="n">adelie</span><span class="p">[</span><span class="s2">&quot;mass&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>As a reminder, here’s how we did that with <code class="docutils literal notranslate"><span class="pre">linregress</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">linregress</span>

<span class="n">result_linregress</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">flipper_length</span><span class="p">,</span> <span class="n">body_mass</span><span class="p">)</span>
<span class="n">result_linregress</span><span class="o">.</span><span class="n">intercept</span><span class="p">,</span> <span class="n">result_linregress</span><span class="o">.</span><span class="n">slope</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(np.float64(-2535.8368022002514), np.float64(32.83168975115009))
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">StatsModels</span></code> provides two interfaces (APIs) – we’ll use the “formula” API, which uses the Patsy formula language to specify the response and explanatory variables.
The following formula string specifies that the response variable, <code class="docutils literal notranslate"><span class="pre">mass</span></code>, is a linear function of one explanatory variable, <code class="docutils literal notranslate"><span class="pre">flipper_length</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="s2">&quot;mass ~ flipper_length&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>We can pass this formula to the <code class="docutils literal notranslate"><span class="pre">StatsModels</span></code> function <code class="docutils literal notranslate"><span class="pre">ols</span></code>, along with the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.formula.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">smf</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">adelie</span><span class="p">)</span>
<span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>statsmodels.regression.linear_model.OLS
</pre></div>
</div>
</div>
</div>
<p>The name <code class="docutils literal notranslate"><span class="pre">ols</span></code> stands for “ordinary least squares”, which indicates that this function computes a least squares fit under the most common, or “ordinary”, set of assumptions.</p>
<p>The result is an <code class="docutils literal notranslate"><span class="pre">OLS</span></code> object that represents the model.
In general, a model is a simplified description of the relationship between variables.
In this example, it’s a linear model, which means that it assumes that the response variable is a linear function of the explanatory variables.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">fit</span></code> method fits the model to the data and returns a <code class="docutils literal notranslate"><span class="pre">RegressionResults</span></code> object that contains the result.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_ols</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Technically it&#39;s a RegressionResultsWrapper</span>

<span class="nb">type</span><span class="p">(</span><span class="n">result_ols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>statsmodels.regression.linear_model.RegressionResultsWrapper
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">RegressionResults</span></code> object contains a lot of information, so <code class="docutils literal notranslate"><span class="pre">thinkstats</span></code> provides a function that just displays the information we need for now.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">thinkstats</span><span class="w"> </span><span class="kn">import</span> <span class="n">display_summary</span>

<span class="n">display_summary</span><span class="p">(</span><span class="n">result_ols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
         <td></td>           <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>      <td>-2535.8368</td> <td>  964.798</td> <td>   -2.628</td> <td> 0.009</td> <td>-4442.291</td> <td> -629.382</td>
</tr>
<tr>
  <th>flipper_length</th> <td>   32.8317</td> <td>    5.076</td> <td>    6.468</td> <td> 0.000</td> <td>   22.801</td> <td>   42.862</td>
</tr>
</table></div><div class="output text_html"><table class="simpletable">
<tr>
  <td>R-squared:</td> <td>0.2192</td>
</tr>
</table></div></div>
</div>
<p>The first column contains the intercept and slope, which are the <strong>coefficients</strong> of the model.
We can confirm that they are the same as the coefficients we got from <code class="docutils literal notranslate"><span class="pre">linregress</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_linregress</span><span class="o">.</span><span class="n">intercept</span><span class="p">,</span> <span class="n">result_linregress</span><span class="o">.</span><span class="n">slope</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(np.float64(-2535.8368022002514), np.float64(32.83168975115009))
</pre></div>
</div>
</div>
</div>
<p>The second column contains the standard errors of the coefficients – again, they are the same as the values we got from <code class="docutils literal notranslate"><span class="pre">linregress</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_linregress</span><span class="o">.</span><span class="n">intercept_stderr</span><span class="p">,</span> <span class="n">result_linregress</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(np.float64(964.7984274994059), np.float64(5.076138407990821))
</pre></div>
</div>
</div>
</div>
<p>The next column reports <span class="math notranslate nohighlight">\(t\)</span> statistics, which are used to compute p-values – we can ignore them, because the p-values are in the next column, labeled <code class="docutils literal notranslate"><span class="pre">P&gt;|t|</span></code>.
The p-value for <code class="docutils literal notranslate"><span class="pre">flipper_length</span></code> is rounded down to 0, but we can display it like this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_ols</span><span class="o">.</span><span class="n">pvalues</span><span class="p">[</span><span class="s2">&quot;flipper_length&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(1.3432645947789321e-09)
</pre></div>
</div>
</div>
</div>
<p>And confirm that <code class="docutils literal notranslate"><span class="pre">linregress</span></code> computed the same result.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_linregress</span><span class="o">.</span><span class="n">pvalue</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(1.3432645947790051e-09)
</pre></div>
</div>
</div>
</div>
<p>The p-value is very small, which means that if there were actually no relationship between weight and flipper length, it is very unlikely we would see a slope as big as the estimated value by chance.</p>
<p>The last two columns, labeled <code class="docutils literal notranslate"><span class="pre">[0.025</span></code> and <code class="docutils literal notranslate"><span class="pre">0.975]</span></code>, report 95% confidence intervals for the intercept and slope.
So the 95% CI for the slope is [22.8, 42.9].</p>
<p>The last line reports the <span class="math notranslate nohighlight">\(R^2\)</span> value of the model, which is about 0.22 – that means we can reduce MSE by about 22% if we use flipper length to predict weight, compared to using only the average weight.</p>
<p>The <span class="math notranslate nohighlight">\(R^2\)</span> value we get from simple correlation is the square of the correlation coefficient, <span class="math notranslate nohighlight">\(r\)</span>.
So we can compare <code class="docutils literal notranslate"><span class="pre">rsquared</span></code> computed by <code class="docutils literal notranslate"><span class="pre">ols</span></code> with the square of the <code class="docutils literal notranslate"><span class="pre">rvalue</span></code> computed by <code class="docutils literal notranslate"><span class="pre">linregress</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_ols</span><span class="o">.</span><span class="n">rsquared</span><span class="p">,</span> <span class="n">result_linregress</span><span class="o">.</span><span class="n">rvalue</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(np.float64(0.21921282646854878), np.float64(0.21921282646854875))
</pre></div>
</div>
</div>
</div>
<p>hey are the same except for a small difference due to floating-point approximation.</p>
<p>Before we go on to multiple regression, let’s compute one more simple regression, with <code class="docutils literal notranslate"><span class="pre">culmen_length</span></code> as the explanatory variable (the culmen is the top ridge of the bill).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="s2">&quot;mass ~ culmen_length&quot;</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">adelie</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">display_summary</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
        <td></td>           <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>     <td>   34.8830</td> <td>  458.439</td> <td>    0.076</td> <td> 0.939</td> <td> -870.998</td> <td>  940.764</td>
</tr>
<tr>
  <th>culmen_length</th> <td>   94.4998</td> <td>   11.790</td> <td>    8.015</td> <td> 0.000</td> <td>   71.202</td> <td>  117.798</td>
</tr>
</table></div><div class="output text_html"><table class="simpletable">
<tr>
  <td>R-squared:</td> <td>0.3013</td>
</tr>
</table></div></div>
</div>
<p>Again, the p-value of the slope is very small, which means that if there were actually no relationship between mass and culmen length, it is unlikely we would see a slope this big by chance.
You might notice that the p-value associated with the intercept is large, but that’s not a problem because we are not concerned about whether the intercept might be zero.
In this model, the intercept is close to zero, but that’s just a coincidence – it doesn’t indicate a problem with the model.</p>
<p>The <span class="math notranslate nohighlight">\(R^2\)</span> value for this model is about 0.30, so the reduction in MSE is a little higher if we use culmen length rather than flipper length as an explanatory variable (the <span class="math notranslate nohighlight">\(R^2\)</span> value with flipper length is 0.22).
Now, let’s see what happens if we combine them.</p>
</section>
<section id="on-to-multiple-regression">
<h2>On To Multiple Regression<a class="headerlink" href="#on-to-multiple-regression" title="Link to this heading">#</a></h2>
<p>Here’s the Patsy formula for a multiple regression model where mass is a linear function of both flipper length and culmen length.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="s2">&quot;mass ~ flipper_length + culmen_length&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>And here is the result of fitting this model to the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">adelie</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">display_summary</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
         <td></td>           <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>      <td>-3573.0817</td> <td>  866.739</td> <td>   -4.122</td> <td> 0.000</td> <td>-5285.864</td> <td>-1860.299</td>
</tr>
<tr>
  <th>flipper_length</th> <td>   22.7024</td> <td>    4.742</td> <td>    4.787</td> <td> 0.000</td> <td>   13.331</td> <td>   32.074</td>
</tr>
<tr>
  <th>culmen_length</th>  <td>   76.3402</td> <td>   11.644</td> <td>    6.556</td> <td> 0.000</td> <td>   53.331</td> <td>   99.350</td>
</tr>
</table></div><div class="output text_html"><table class="simpletable">
<tr>
  <td>R-squared:</td> <td>0.3949</td>
</tr>
</table></div></div>
</div>
<p>This model has three coefficients: an intercept and two slopes.
The slope associated with flipper length is 22.7, which means we expect a penguin with a longer flipper, by one millimeter, to weight more, by 22.7 grams – assuming that culmen length is the same.
Similarly, we expect a penguin with a longer culmen, by one millimeter, to weight more, by 76.3 grams – assuming that flipper length is the same.</p>
<p>The p-values associated with both slopes are small, which means that the contribution of both explanatory variables would be unlikely to happen by chance.</p>
<p>And the <span class="math notranslate nohighlight">\(R^2\)</span> value is 0.39, higher than the model with only culmen length (0.30) and the model with only flipper length (0.22).
So predictions based on both explanatory variables are better than predictions based on either one alone.</p>
<p>But they are not as much better as we might have hoped.
If flipper length reduces MSE by 22% and culmen length reduces it by 30%, why don’t the two of them together reduce it by a total of 52%?
The reason is that the explanatory variables are correlated with each other.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">thinkstats</span><span class="w"> </span><span class="kn">import</span> <span class="n">corrcoef</span>

<span class="n">corrcoef</span><span class="p">(</span><span class="n">adelie</span><span class="p">,</span> <span class="s2">&quot;flipper_length&quot;</span><span class="p">,</span> <span class="s2">&quot;culmen_length&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(0.32578471516515944)
</pre></div>
</div>
</div>
</div>
<p>A penguin with a longer flipper also has a longer culmen, on average.
The explanatory variables contain some information about each other, which means that they contain some of the same information about the response variable.
When we add an explanatory variable to the model, the improvement in <span class="math notranslate nohighlight">\(R^2\)</span> reflects only the new information provided by the new variable.</p>
<p>We see the same pattern if we add culmen depth as a third explanatory variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="s2">&quot;mass ~ flipper_length + culmen_length + culmen_depth&quot;</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">adelie</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">display_summary</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
         <td></td>           <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>      <td>-4341.3019</td> <td>  795.117</td> <td>   -5.460</td> <td> 0.000</td> <td>-5912.639</td> <td>-2769.964</td>
</tr>
<tr>
  <th>flipper_length</th> <td>   17.4215</td> <td>    4.385</td> <td>    3.973</td> <td> 0.000</td> <td>    8.756</td> <td>   26.087</td>
</tr>
<tr>
  <th>culmen_length</th>  <td>   55.3676</td> <td>   11.133</td> <td>    4.973</td> <td> 0.000</td> <td>   33.366</td> <td>   77.369</td>
</tr>
<tr>
  <th>culmen_depth</th>   <td>  140.8946</td> <td>   24.216</td> <td>    5.818</td> <td> 0.000</td> <td>   93.037</td> <td>  188.752</td>
</tr>
</table></div><div class="output text_html"><table class="simpletable">
<tr>
  <td>R-squared:</td> <td>0.5082</td>
</tr>
</table></div></div>
</div>
<p>This model has four coefficients.
All of the p-values are small, which means that the contribution of each explanatory variable would be unlikely to happen by chance.
And the <span class="math notranslate nohighlight">\(R^2\)</span> value is about 0.51, somewhat better than the previous model with two explanatory variables (0.39), and better than either model with a single variable (0.22 and 0.30).</p>
<p>But again, the incremental improvement is smaller than we might have hoped, because culmen depth is correlated with the other two measurements.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="n">corrcoef</span><span class="p">(</span><span class="n">adelie</span><span class="p">,</span> <span class="s2">&quot;culmen_depth&quot;</span><span class="p">,</span> <span class="s2">&quot;flipper_length&quot;</span><span class="p">),</span>
    <span class="n">corrcoef</span><span class="p">(</span><span class="n">adelie</span><span class="p">,</span> <span class="s2">&quot;culmen_depth&quot;</span><span class="p">,</span> <span class="s2">&quot;culmen_length&quot;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[np.float64(0.30762017939668534), np.float64(0.39149169183587634)]
</pre></div>
</div>
</div>
</div>
<p>This example demonstrates a common use of multiple regression, combining multiple explanatory variables to make better predictions.
Another common use is to quantify the contribution of one set of variables while controlling for the contribution of another set.</p>
</section>
<section id="control-variables">
<h2>Control Variables<a class="headerlink" href="#control-variables" title="Link to this heading">#</a></h2>
<p>In Section <a class="reference internal" href="chap04.html#section-comparing-cdfs"><span class="std std-ref">Chapter 4</span></a> we saw that first babies are lighter than other babies, on average.
And in <a class="reference internal" href="chap09.html#section-test-correlation"><span class="std std-ref">Chapter 9</span></a> we saw that birth weight is correlated with the mother’s age – older mothers have heavier babies on average.</p>
<p>These results might be related.
If mothers of first babies are younger than mothers of other babies – which seems likely – that might explain why their babies are lighter.
We can use multiple regression to test this conjecture, by estimating the difference in birth weight between first babies and others while controlling for the mothers’ ages.</p>
<p>Instructions for downloading the NSFG data are in the notebook for this chapter.</p>
<p>The following cells download the data files and install <code class="docutils literal notranslate"><span class="pre">statadict</span></code>, which we need to read the data.</p>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;https://github.com/AllenDowney/ThinkStats/raw/v3/nb/nsfg.py&quot;</span><span class="p">)</span>
<span class="n">download</span><span class="p">(</span><span class="s2">&quot;https://github.com/AllenDowney/ThinkStats/raw/v3/data/2002FemPreg.dct&quot;</span><span class="p">)</span>
<span class="n">download</span><span class="p">(</span><span class="s2">&quot;https://github.com/AllenDowney/ThinkStats/raw/v3/data/2002FemPreg.dat.gz&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">statadict</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="o">%</span><span class="k">pip</span> install statadict
</pre></div>
</div>
</div>
</div>
<p>We can use <code class="docutils literal notranslate"><span class="pre">get_nsfg_groups</span></code> to read the data, select live births, and group live births into first babies and others.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">nsfg</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_nsfg_groups</span>

<span class="n">live</span><span class="p">,</span> <span class="n">firsts</span><span class="p">,</span> <span class="n">others</span> <span class="o">=</span> <span class="n">get_nsfg_groups</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We’ll use <code class="docutils literal notranslate"><span class="pre">dropna</span></code> to select the rows with valid birth weights, birth order, and mother’s ages.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valid</span> <span class="o">=</span> <span class="n">live</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;agepreg&quot;</span><span class="p">,</span> <span class="s2">&quot;birthord&quot;</span><span class="p">,</span> <span class="s2">&quot;totalwgt_lb&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can use <code class="docutils literal notranslate"><span class="pre">StatsModels</span></code> to confirm that birth weight is correlated with age, and to estimate the slope – assuming that it is a linear relationship.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="s2">&quot;totalwgt_lb ~ agepreg&quot;</span>
<span class="n">result_age</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">valid</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">display_summary</span><span class="p">(</span><span class="n">result_age</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
      <td></td>         <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th> <td>    6.8304</td> <td>    0.068</td> <td>  100.470</td> <td> 0.000</td> <td>    6.697</td> <td>    6.964</td>
</tr>
<tr>
  <th>agepreg</th>   <td>    0.0175</td> <td>    0.003</td> <td>    6.559</td> <td> 0.000</td> <td>    0.012</td> <td>    0.023</td>
</tr>
</table></div><div class="output text_html"><table class="simpletable">
<tr>
  <td>R-squared:</td> <td>0.004738</td>
</tr>
</table></div></div>
</div>
<p>The slope is small, only 0.0175 pounds per year.
So if two mothers differ in age by a decade, we expect their babies to differ in weight by 0.175 pounds.
But the p-value is small, so this slope – small as it is – would be unlikely if there were actually no relationship.</p>
<p>The <span class="math notranslate nohighlight">\(R^2\)</span> value is also small, which means that mother’s age is not very useful as a predictive variable.
If we know the mother’s age, our ability to predict the baby’s weight is hardly improved at all.</p>
<p>This combination of a small p-value and a small <span class="math notranslate nohighlight">\(R^2\)</span> value is a common source of confusion, because it seems contradictory – if the relationship is statistically significant, it seems like it should be predictive.
But this example shows that there is no contradiction – a relationship can be statistically significant but not very useful for prediction.
If we visualize the results, we’ll see why.
First let’s select the relevant columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">totalwgt</span> <span class="o">=</span> <span class="n">valid</span><span class="p">[</span><span class="s2">&quot;totalwgt_lb&quot;</span><span class="p">]</span>
<span class="n">agepreg</span> <span class="o">=</span> <span class="n">valid</span><span class="p">[</span><span class="s2">&quot;agepreg&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>To compute the fitted line, we could extract the intercept and slope from <code class="docutils literal notranslate"><span class="pre">result_age</span></code>, but we don’t have to.
The <code class="docutils literal notranslate"><span class="pre">RegressionResults</span></code> object provides a <code class="docutils literal notranslate"><span class="pre">predict</span></code> method we can use instead.
First we’ll compute a range of values for <code class="docutils literal notranslate"><span class="pre">agepreg</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">agepreg_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">agepreg</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">agepreg</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>To use <code class="docutils literal notranslate"><span class="pre">predict</span></code>, we have to put values for the explanatory variables in a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;agepreg&quot;</span><span class="p">:</span> <span class="n">agepreg_range</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>The columns in the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> have to have the same names as the explanatory variables.
Then we can pass it to <code class="docutils literal notranslate"><span class="pre">predict</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit_ys</span> <span class="o">=</span> <span class="n">result_age</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The result is a <code class="docutils literal notranslate"><span class="pre">Series</span></code> containing the predicted values.
Here’s what they look like, along with a scatter plot of the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">agepreg</span><span class="p">,</span> <span class="n">totalwgt</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">agepreg_range</span><span class="p">,</span> <span class="n">fit_ys</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;linear model&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Maternal age&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Birth weight (pounds)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/cda101f361df541b28c8f63c79ee4f28dfa51697aa87a2bebc4a0b01a492658d.png" src="_images/cda101f361df541b28c8f63c79ee4f28dfa51697aa87a2bebc4a0b01a492658d.png" />
</div>
</div>
<p>Because the slope of the fitted line is small, we can barely see the difference in the expected birth weight between the youngest and oldest mothers.
The variation in birth weight, at every maternal age, is much larger.</p>
<p>Next we’ll use <code class="docutils literal notranslate"><span class="pre">StatsModels</span></code> to confirm that first babies are lighter than others.
To make that work, we’ll create a Boolean <code class="docutils literal notranslate"><span class="pre">Series</span></code> that is <code class="docutils literal notranslate"><span class="pre">True</span></code> for first babies and <code class="docutils literal notranslate"><span class="pre">False</span></code> for others, and add it as a new column called <code class="docutils literal notranslate"><span class="pre">is_first</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valid</span><span class="p">[</span><span class="s2">&quot;is_first&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">valid</span><span class="p">[</span><span class="s2">&quot;birthord&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">thinkstats</span><span class="w"> </span><span class="kn">import</span> <span class="n">value_counts</span>

<span class="c1"># check the results</span>
<span class="n">value_counts</span><span class="p">(</span><span class="n">valid</span><span class="p">[</span><span class="s2">&quot;is_first&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>is_first
False    4675
True     4363
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Here’s the formula for a model with birth weight as the response variable and <code class="docutils literal notranslate"><span class="pre">is_first</span></code> as the explanatory variable.
In the Patsy formula language, <code class="docutils literal notranslate"><span class="pre">C</span></code> and the parentheses around the variable name indicate that it is <strong>categorical</strong> – that is, it represents categories like “first baby” rather than measurements like birth weight.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="s2">&quot;totalwgt_lb ~ C(is_first)&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can fit the model and display the results, as usual.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_first</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">valid</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">display_summary</span><span class="p">(</span><span class="n">result_first</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
           <td></td>              <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>           <td>    7.3259</td> <td>    0.021</td> <td>  356.007</td> <td> 0.000</td> <td>    7.286</td> <td>    7.366</td>
</tr>
<tr>
  <th>C(is_first)[T.True]</th> <td>   -0.1248</td> <td>    0.030</td> <td>   -4.212</td> <td> 0.000</td> <td>   -0.183</td> <td>   -0.067</td>
</tr>
</table></div><div class="output text_html"><table class="simpletable">
<tr>
  <td>R-squared:</td> <td>0.00196</td>
</tr>
</table></div></div>
</div>
<p>In the results, the label <code class="docutils literal notranslate"><span class="pre">C(is_first)[T.True]</span></code> indicates that <code class="docutils literal notranslate"><span class="pre">is_first</span></code> is a categorical variable and the coefficient is associated with the value <code class="docutils literal notranslate"><span class="pre">True</span></code>.
The <code class="docutils literal notranslate"><span class="pre">T</span></code> before <code class="docutils literal notranslate"><span class="pre">True</span></code> stands for “treatment” – in the language of a controlled experiment, first babies are considered the treatment group and other babies are considered the reference group.
These designations are arbitrary – we could consider first babies to be the reference group and others to be the treatment group.
But we need to know which is which in order to interpret the results.</p>
<p>The intercept is about 7.3, which means that the average weight of the reference group is 7.3 pounds.
The coefficient of <code class="docutils literal notranslate"><span class="pre">is_first</span></code> is -0.12, which means that the average weight of the treatment group – first babies – is 0.12 pounds lighter.
We can check both of these results by computing them directly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">others</span><span class="p">[</span><span class="s2">&quot;totalwgt_lb&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(7.325855614973262)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diff_weight</span> <span class="o">=</span> <span class="n">firsts</span><span class="p">[</span><span class="s2">&quot;totalwgt_lb&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">others</span><span class="p">[</span><span class="s2">&quot;totalwgt_lb&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">diff_weight</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(-0.12476118453549034)
</pre></div>
</div>
</div>
</div>
<p>In addition to these coefficients, <code class="docutils literal notranslate"><span class="pre">StatsModels</span></code> also computes p-values, confidence intervals, and <span class="math notranslate nohighlight">\(R^2\)</span>.
The p-value associated with first babies is small, which means that the difference between the groups is statistically significant.
And the <span class="math notranslate nohighlight">\(R^2\)</span> value is small, which means that if we’re trying to guess the weight of a baby, it doesn’t help much to know whether it is a first baby.</p>
<p>Now let’s see if it’s plausible that the difference in birth weight is due to the difference in maternal age.
On average, mothers of first babies are about 3.6 years younger than other mothers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diff_age</span> <span class="o">=</span> <span class="n">firsts</span><span class="p">[</span><span class="s2">&quot;agepreg&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">others</span><span class="p">[</span><span class="s2">&quot;agepreg&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">diff_age</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(-3.5864347661500275)
</pre></div>
</div>
</div>
</div>
<p>And the slope of birth weight as a function of age is 0.0175 pounds per year.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">slope</span> <span class="o">=</span> <span class="n">result_age</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;agepreg&quot;</span><span class="p">]</span>
<span class="n">slope</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(0.017453851471802638)
</pre></div>
</div>
</div>
</div>
<p>If we multiply the slope by the difference in ages, we get the expected difference in birth weight for first babies and others, due to mother’s age.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">slope</span> <span class="o">*</span> <span class="n">diff_age</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(-0.0625970997216918)
</pre></div>
</div>
</div>
</div>
<p>The result is 0.063 pounds, which is about half of the observed difference.
So it seems like the observed difference in birth weight can be partly explained by the difference in mother’s age.</p>
<p>Using multiple regression, we can estimate coefficients for maternal age and first babies at the same time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="s2">&quot;totalwgt_lb ~ agepreg + C(is_first)&quot;</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">valid</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">display_summary</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
           <td></td>              <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>           <td>    6.9142</td> <td>    0.078</td> <td>   89.073</td> <td> 0.000</td> <td>    6.762</td> <td>    7.066</td>
</tr>
<tr>
  <th>C(is_first)[T.True]</th> <td>   -0.0698</td> <td>    0.031</td> <td>   -2.236</td> <td> 0.025</td> <td>   -0.131</td> <td>   -0.009</td>
</tr>
<tr>
  <th>agepreg</th>             <td>    0.0154</td> <td>    0.003</td> <td>    5.499</td> <td> 0.000</td> <td>    0.010</td> <td>    0.021</td>
</tr>
</table></div><div class="output text_html"><table class="simpletable">
<tr>
  <td>R-squared:</td> <td>0.005289</td>
</tr>
</table></div></div>
</div>
<p>The coefficient of <code class="docutils literal notranslate"><span class="pre">is_first</span></code> is -0.0698, which means that first babies are 0.0698 pounds lighter than others, on average, after accounting for the difference due to maternal age.
That’s about half of the difference we get without accounting for maternal age.</p>
<p>And the p-value is 0.025, which is still considered statistically significant, but it is in the borderline range where we can’t exclude the possibility that a difference this size could happen by chance.</p>
<p>Because this model takes into account the weight difference due to maternal age, we can say that it <strong>controls for</strong> maternal age.
But it assumes that the relationship between weight and maternal age is linear.
So let’s see if that’s true.</p>
</section>
<section id="nonlinear-relationships">
<h2>Nonlinear Relationships<a class="headerlink" href="#nonlinear-relationships" title="Link to this heading">#</a></h2>
<p>To check whether the contribution of <code class="docutils literal notranslate"><span class="pre">agepreg</span></code> might be nonlinear, we can add a new column to the dataset, which contains the values of <code class="docutils literal notranslate"><span class="pre">agepreg</span></code> squared.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valid</span><span class="p">[</span><span class="s2">&quot;agepreg2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">valid</span><span class="p">[</span><span class="s2">&quot;agepreg&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can define a model that includes a linear relationship <em>and</em> a quadratic relationship.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="s2">&quot;totalwgt_lb ~ agepreg + agepreg2&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>We can fit the model in the usual way.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_age2</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">valid</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">display_summary</span><span class="p">(</span><span class="n">result_age2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
      <td></td>         <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th> <td>    5.5720</td> <td>    0.275</td> <td>   20.226</td> <td> 0.000</td> <td>    5.032</td> <td>    6.112</td>
</tr>
<tr>
  <th>agepreg</th>   <td>    0.1186</td> <td>    0.022</td> <td>    5.485</td> <td> 0.000</td> <td>    0.076</td> <td>    0.161</td>
</tr>
<tr>
  <th>agepreg2</th>  <td>   -0.0019</td> <td>    0.000</td> <td>   -4.714</td> <td> 0.000</td> <td>   -0.003</td> <td>   -0.001</td>
</tr>
</table></div><div class="output text_html"><table class="simpletable">
<tr>
  <td>R-squared:</td> <td>0.00718</td>
</tr>
</table></div></div>
</div>
<p>The p-value associated with the quadratic term, <code class="docutils literal notranslate"><span class="pre">agepreg2</span></code>, is very small, which suggests that it contributes more information about birth weight than we would expect by chance.
And the <span class="math notranslate nohighlight">\(R^2\)</span> value for this model is 0.0072, higher than for the linear model (0.0047).</p>
<p>By estimating coefficients for <code class="docutils literal notranslate"><span class="pre">agepreg</span></code> and <code class="docutils literal notranslate"><span class="pre">agepreg2</span></code>, we are effectively fitting a parabola to the data.
To see that, we can use the <code class="docutils literal notranslate"><span class="pre">RegressionResults</span></code> object to generate predictions for a range of maternal ages.</p>
<p>First we’ll create a temporary <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> that contains columns named <code class="docutils literal notranslate"><span class="pre">agepreg</span></code> and <code class="docutils literal notranslate"><span class="pre">agepreg2</span></code>, based on the range of ages in <code class="docutils literal notranslate"><span class="pre">agepreg_range</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;agepreg&quot;</span><span class="p">:</span> <span class="n">agepreg_range</span><span class="p">})</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;agepreg2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;agepreg&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can use the <code class="docutils literal notranslate"><span class="pre">predict</span></code> method, passing the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> as an argument and getting back a <code class="docutils literal notranslate"><span class="pre">Series</span></code> of predictions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit_ys</span> <span class="o">=</span> <span class="n">result_age2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s what the fitted parabola looks like, along with a scatter plot of the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">agepreg</span><span class="p">,</span> <span class="n">totalwgt</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">agepreg_range</span><span class="p">,</span> <span class="n">fit_ys</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;quadratic model&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Maternal age&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Birth weight (pounds)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d94663cfe1d824e31e3655424abdf4415e1e69bdd489d7dcdec9e41d61c5e329.png" src="_images/d94663cfe1d824e31e3655424abdf4415e1e69bdd489d7dcdec9e41d61c5e329.png" />
</div>
</div>
<p>The curvature is subtle, but it suggests that birth weights are lower for the youngest and oldest mothers, and higher in the middle.</p>
<p>The quadratic model captures the relationship between these variables better than the linear model, which means it can account more effectively for the difference in birth weight due to maternal age.
So let’s see what happens when we add <code class="docutils literal notranslate"><span class="pre">is_first</span></code> to the quadratic model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="s2">&quot;totalwgt_lb ~ agepreg + agepreg2 + C(is_first)&quot;</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">valid</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">display_summary</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
           <td></td>              <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>           <td>    5.6923</td> <td>    0.286</td> <td>   19.937</td> <td> 0.000</td> <td>    5.133</td> <td>    6.252</td>
</tr>
<tr>
  <th>C(is_first)[T.True]</th> <td>   -0.0504</td> <td>    0.031</td> <td>   -1.602</td> <td> 0.109</td> <td>   -0.112</td> <td>    0.011</td>
</tr>
<tr>
  <th>agepreg</th>             <td>    0.1124</td> <td>    0.022</td> <td>    5.113</td> <td> 0.000</td> <td>    0.069</td> <td>    0.155</td>
</tr>
<tr>
  <th>agepreg2</th>            <td>   -0.0018</td> <td>    0.000</td> <td>   -4.447</td> <td> 0.000</td> <td>   -0.003</td> <td>   -0.001</td>
</tr>
</table></div><div class="output text_html"><table class="simpletable">
<tr>
  <td>R-squared:</td> <td>0.007462</td>
</tr>
</table></div></div>
</div>
<p>With a more effective control for maternal age, the estimated difference between first babies and others is 0.0504 pounds, smaller than the estimate with just the linear model (0.0698 pounds).
And the p-value associated with <code class="docutils literal notranslate"><span class="pre">is_first</span></code> is 0.109, which mean it is plausible that the remaining difference between these groups is due to chance.</p>
<p>We can conclude that the difference in birth weight is explained – at least in part and possibly in full – by the difference in mother’s age.</p>
</section>
<section id="logistic-regression">
<h2>Logistic Regression<a class="headerlink" href="#logistic-regression" title="Link to this heading">#</a></h2>
<p>Linear regression is based on a model where the expected value of the response variable is the weighted sum of the explanatory variables and an intercept.
This model is appropriate when the response variable is a continuous quantity like birth weight or penguin mass, but not when the response variable is a discrete quantity like a count or a category.</p>
<p>For these kinds of response variables, we can use <strong>generalized linear models</strong> or GLMs.
For example:</p>
<ul class="simple">
<li><p>If the response variable is a count, we can use Poisson regression.</p></li>
<li><p>If it’s categorical with only two categories, we can use logistic regression.</p></li>
<li><p>If it’s categorical with more than two categories, we can use multinomial logistic regression.</p></li>
<li><p>If it’s categorical and the categories can be arranged in order, we can use ordered logistic regression.</p></li>
</ul>
<p>We won’t cover all of them in this book – just <strong>logistic regression</strong>, which is the most widely used.
As an example, we’ll use the penguin dataset again, and see if we can tell whether a penguin is male or female, based on its weight and other measurements.</p>
<p><code class="docutils literal notranslate"><span class="pre">StatsModels</span></code> provides a function that does logistic regression – it’s called <code class="docutils literal notranslate"><span class="pre">logit</span></code> because that’s the name of a mathematical function that appears in the definition of logistic regression.
Before we can use the <code class="docutils literal notranslate"><span class="pre">logit</span></code> function, we have to transform the response variable so the values are <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adelie</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">adelie</span><span class="p">[</span><span class="s2">&quot;Sex&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;MALE&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adelie</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>y
0    78
1    73
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>We’ll start with a simple model with <code class="docutils literal notranslate"><span class="pre">y</span></code> as the response variable and <code class="docutils literal notranslate"><span class="pre">mass</span></code> as the explanatory variable.
Here’s how we make and fit the model – the argument <code class="docutils literal notranslate"><span class="pre">disp=False</span></code> suppresses messages about the fitting process.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="s2">&quot;y ~ mass&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">adelie</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And here are the results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display_summary</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
      <td></td>         <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th> <td>  -25.9871</td> <td>    4.221</td> <td>   -6.156</td> <td> 0.000</td> <td>  -34.261</td> <td>  -17.713</td>
</tr>
<tr>
  <th>mass</th>      <td>    0.0070</td> <td>    0.001</td> <td>    6.138</td> <td> 0.000</td> <td>    0.005</td> <td>    0.009</td>
</tr>
</table></div><div class="output text_html"><table class="simpletable">
<tr>
  <td>Pseudo R-squared:</td> <td>0.5264</td>
</tr>
</table></div></div>
</div>
<p>The coefficient of determination, <span class="math notranslate nohighlight">\(R^2\)</span>, does not apply to logistic regression, but there are several alternatives that are used as “pseudo <span class="math notranslate nohighlight">\(R^2\)</span> values.”
The pseudo <span class="math notranslate nohighlight">\(R^2\)</span> value for this model is about 0.526, which doesn’t mean much by itself, but we will use it to compare models.</p>
<p>The coefficient of <code class="docutils literal notranslate"><span class="pre">mass</span></code> is positive, which means that heavier penguins are more likely to be male.
Other than that, the coefficients are not easy to interpret – we can understand the model better by plotting the predictions.
We’ll make a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> with a range of values for <code class="docutils literal notranslate"><span class="pre">mass</span></code>, and use <code class="docutils literal notranslate"><span class="pre">predict</span></code> to compute a <code class="docutils literal notranslate"><span class="pre">Series</span></code> of predictions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mass</span> <span class="o">=</span> <span class="n">adelie</span><span class="p">[</span><span class="s2">&quot;mass&quot;</span><span class="p">]</span>
<span class="n">mass_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mass</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">mass</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;mass&quot;</span><span class="p">:</span> <span class="n">mass_range</span><span class="p">})</span>
<span class="n">fit_ys</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Each predicted value is the probability a penguin is male as a function of its weight.
Here’s what the predicted values look like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mass_range</span><span class="p">,</span> <span class="n">fit_ys</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Mass (g)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Prob(male)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c3e7e2a0a8a5c8b5e43914e573c0fc1edebf5ee62c0448ddb4ef9c70a63f350b.png" src="_images/c3e7e2a0a8a5c8b5e43914e573c0fc1edebf5ee62c0448ddb4ef9c70a63f350b.png" />
</div>
</div>
<p>The lightest penguins are almost certain to be female, and the heaviest are likely to be male – in the middle, a penguin weighing 3750 grams is about equally likely to be male or female.</p>
<p>Now let’s see what happens if we add the other measurements as explanatory variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="s2">&quot;y ~ mass + flipper_length + culmen_length + culmen_depth&quot;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">adelie</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">display_summary</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
         <td></td>           <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>      <td>  -60.6075</td> <td>   13.793</td> <td>   -4.394</td> <td> 0.000</td> <td>  -87.642</td> <td>  -33.573</td>
</tr>
<tr>
  <th>mass</th>           <td>    0.0059</td> <td>    0.001</td> <td>    4.153</td> <td> 0.000</td> <td>    0.003</td> <td>    0.009</td>
</tr>
<tr>
  <th>flipper_length</th> <td>   -0.0209</td> <td>    0.052</td> <td>   -0.403</td> <td> 0.687</td> <td>   -0.123</td> <td>    0.081</td>
</tr>
<tr>
  <th>culmen_length</th>  <td>    0.6208</td> <td>    0.176</td> <td>    3.536</td> <td> 0.000</td> <td>    0.277</td> <td>    0.965</td>
</tr>
<tr>
  <th>culmen_depth</th>   <td>    1.0111</td> <td>    0.349</td> <td>    2.896</td> <td> 0.004</td> <td>    0.327</td> <td>    1.695</td>
</tr>
</table></div><div class="output text_html"><table class="simpletable">
<tr>
  <td>Pseudo R-squared:</td> <td>0.6622</td>
</tr>
</table></div></div>
</div>
<p>The pseudo <span class="math notranslate nohighlight">\(R^2\)</span> value of this model is 0.662, higher than the previous model (0.526) – so the additional measurements contain additional information that distinguishes male and female penguins.</p>
<p>The p-values for culmen length and depth are small, which indicates that they contribute more information than we expect by chance.
The p-value for flipper length is large, which suggests that if you know a penguin’s weight and bill dimensions, flipper length doesn’t contribute additional information.</p>
<p>To understand this model, let’s look at some of its predictions.
We’ll use the following function, which takes a sequence of masses and a specific value for <code class="docutils literal notranslate"><span class="pre">culmen_length</span></code>.
It sets the other measurements to their mean values, computes predicted probabilities as a function of mass, and plots the results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_predictions</span><span class="p">(</span><span class="n">mass_range</span><span class="p">,</span> <span class="n">culmen_length</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot predicted probabilities as a function of mass.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;mass&quot;</span><span class="p">:</span> <span class="n">mass_range</span><span class="p">})</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;flipper_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adelie</span><span class="p">[</span><span class="s2">&quot;flipper_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;culmen_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">culmen_length</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;culmen_depth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adelie</span><span class="p">[</span><span class="s2">&quot;culmen_depth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">fit_ys</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mass_range</span><span class="p">,</span> <span class="n">fit_ys</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s what the results look like for three values of <code class="docutils literal notranslate"><span class="pre">culmen_length</span></code>: one standard deviation above average, average, and one standard deviation below average.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">culmen_length</span> <span class="o">=</span> <span class="n">adelie</span><span class="p">[</span><span class="s2">&quot;culmen_length&quot;</span><span class="p">]</span>
<span class="n">m</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">culmen_length</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">culmen_length</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_predictions</span><span class="p">(</span><span class="n">mass_range</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="n">s</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Above average culmen length&quot;</span><span class="p">)</span>
<span class="n">plot_predictions</span><span class="p">(</span><span class="n">mass_range</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Average culmen length&quot;</span><span class="p">)</span>
<span class="n">plot_predictions</span><span class="p">(</span><span class="n">mass_range</span><span class="p">,</span> <span class="n">m</span> <span class="o">-</span> <span class="n">s</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Below average culmen length&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Mass (g)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Prob(male)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/af727ffae8b33babe2578c8c6d52d5c3aaed4c4c7dc724ab57bce7a0ce063d53.png" src="_images/af727ffae8b33babe2578c8c6d52d5c3aaed4c4c7dc724ab57bce7a0ce063d53.png" />
</div>
</div>
<p>As we saw in the simpler model, heavier penguins are more likely to be male.
Also, at any weight, a penguin with a longer bill is more likely to be male.</p>
<p>This model is more useful than it might seem – in fact, it is similar to models that were used in the original research paper this dataset was collected for.
The primary topic of that research is sexual dimorphism, which is the degree to which male and female bodies differ.
One way to quantify dimorphism is to use measurements to classify males and females.
In a species with higher dimorphism, we expect these classifications to be more accurate.</p>
<p>The original paper is Gorman KB, Williams TD, Fraser WR (2014). Ecological sexual dimorphism and environmental variability within a community of Antarctic penguins (genus Pygoscelis). PLoS ONE 9(3):e90081. <a class="reference external" href="https://doi.org/10.1371/journal.pone.0090081">https://doi.org/10.1371/journal.pone.0090081</a></p>
<p>To test this methodology, let’s try the same model on a different species.
In addition to the Adélie penguins we’ve worked with so far, the dataset also contains measurements from 123 Gentoo penguins.
We’ll use the following function to select them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_species</span><span class="p">(</span><span class="n">penguins</span><span class="p">,</span> <span class="n">species</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">penguins</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Species.str.startswith(&quot;</span><span class="si">{</span><span class="n">species</span><span class="si">}</span><span class="s1">&quot;)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Sex&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;MALE&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gentoo</span> <span class="o">=</span> <span class="n">get_species</span><span class="p">(</span><span class="n">penguins</span><span class="p">,</span> <span class="s2">&quot;Gentoo&quot;</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">gentoo</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>123
</pre></div>
</div>
</div>
</div>
<p>Here are the results of the logistic regression model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="s2">&quot;y ~ mass + flipper_length + culmen_length + culmen_depth&quot;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">gentoo</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">display_summary</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
         <td></td>           <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>      <td> -173.9123</td> <td>   62.326</td> <td>   -2.790</td> <td> 0.005</td> <td> -296.069</td> <td>  -51.756</td>
</tr>
<tr>
  <th>mass</th>           <td>    0.0105</td> <td>    0.004</td> <td>    2.948</td> <td> 0.003</td> <td>    0.004</td> <td>    0.017</td>
</tr>
<tr>
  <th>flipper_length</th> <td>    0.2839</td> <td>    0.183</td> <td>    1.549</td> <td> 0.121</td> <td>   -0.075</td> <td>    0.643</td>
</tr>
<tr>
  <th>culmen_length</th>  <td>    0.2734</td> <td>    0.285</td> <td>    0.958</td> <td> 0.338</td> <td>   -0.286</td> <td>    0.833</td>
</tr>
<tr>
  <th>culmen_depth</th>   <td>    3.0843</td> <td>    1.291</td> <td>    2.389</td> <td> 0.017</td> <td>    0.554</td> <td>    5.614</td>
</tr>
</table></div><div class="output text_html"><table class="simpletable">
<tr>
  <td>Pseudo R-squared:</td> <td>0.848</td>
</tr>
</table></div></div>
</div>
<p>The pseudo-<span class="math notranslate nohighlight">\(R^2\)</span> value is 0.848, higher than what we got with Adélie penguins (0.662).
That means Gentoo penguins can be classified more accurately using physical measurements, compared to Adélie penguins, which suggests that Gentoo penguins are more dimorphic.</p>
</section>
<section id="glossary">
<h2>Glossary<a class="headerlink" href="#glossary" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>regression</strong>: A method for estimating coefficients that fit a model to data.</p></li>
<li><p><strong>response variables</strong>: The variables a regression model tries to predict, also known as dependent variables.</p></li>
<li><p><strong>explanatory variables</strong>: The variables a model uses to predict the response variables, also known as independent variables.</p></li>
<li><p><strong>simple regression</strong>: A regression with one response variable and one explanatory variable.</p></li>
<li><p><strong>multiple regression</strong>: A regression with multiple explanatory variables, but only one response variable.</p></li>
<li><p><strong>coefficients:</strong> In a regression model, the coefficients are the intercept and the estimated slopes for the explanatory variables.</p></li>
<li><p><strong>categorical variable</strong>: A variable that can have one of a discrete set of values, usually not numerical.</p></li>
<li><p><strong>control variable</strong>: A variable included in a regression to separate the direct effect of an explanatory variable from an indirect effect.</p></li>
<li><p><strong>generalized linear models:</strong> A set of regression models based on different mathematical relationships between the explanatory and response variables.</p></li>
<li><p><strong>logistic regression</strong>: A generalized linear model used when the response variable has only two possible values.</p></li>
</ul>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<section id="exercise-11-1">
<h3>Exercise 11.1<a class="headerlink" href="#exercise-11-1" title="Link to this heading">#</a></h3>
<p>Are baby boys heavier than baby girls? To answer this question, we’ll use the NSFG data again.</p>
<p>Fit a linear regression model with <code class="docutils literal notranslate"><span class="pre">totalwgt_lb</span></code> as the response variable and <code class="docutils literal notranslate"><span class="pre">babysex</span></code> as a categorical explanatory variable – the value of this variable is <code class="docutils literal notranslate"><span class="pre">1</span></code> for boys and <code class="docutils literal notranslate"><span class="pre">2</span></code> for girls.
What is the estimated difference in weight?
Is it statistically significant?
What if you control for the mother’s age – does maternal age account for some or all of the apparent difference?</p>
</section>
<section id="exercise-11-2">
<h3>Exercise 11.2<a class="headerlink" href="#exercise-11-2" title="Link to this heading">#</a></h3>
<p>The Trivers-Willard hypothesis suggests that for many mammals the sex ratio depends on “maternal condition” – that is, factors like the mother’s age, size, health, and social status.
Some studies have shown this effect among humans, but results are mixed.</p>
<p>See <a class="reference external" href="https://en.wikipedia.org/wiki/Trivers-Willard_hypothesis">https://en.wikipedia.org/wiki/Trivers-Willard_hypothesis</a>.</p>
<p>Let’s see if there is a relationship between mother’s age and the probability of having a boy.
Fit a logistic regression model with the baby’s sex as the response variable and mother’s age as an explanatory variable.
Are older mothers more or less likely to have boys?
What if you use a quadratic model of maternal age?</p>
<p>In order to use <code class="docutils literal notranslate"><span class="pre">babysex</span></code> as a response variable in a logistic regression, we’ll recode it with the value <code class="docutils literal notranslate"><span class="pre">1</span></code> for boys and <code class="docutils literal notranslate"><span class="pre">0</span></code> for girls.</p>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valid</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">valid</span><span class="p">[</span><span class="s2">&quot;babysex&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-11-3">
<h3>Exercise 11.3<a class="headerlink" href="#exercise-11-3" title="Link to this heading">#</a></h3>
<p>For the Adelie penguins, fit a linear regression model that predicts penguin weights as a function of <code class="docutils literal notranslate"><span class="pre">flipper_length</span></code>, <code class="docutils literal notranslate"><span class="pre">culmen_depth</span></code>,  and <code class="docutils literal notranslate"><span class="pre">Sex</span></code> as a categorical variable.
If we control for flipper length and culmen depth, how much heavier are male penguins?
Generate and plot predictions for a range of flipper lengths, for male and female penguins, with <code class="docutils literal notranslate"><span class="pre">culmen_depth</span></code> set to its average value.</p>
</section>
<section id="exercise-11-4">
<h3>Exercise 11.4<a class="headerlink" href="#exercise-11-4" title="Link to this heading">#</a></h3>
<p>Let’s see if Chinstrap penguins are more or less dimorphic than the other penguin species in the dataset, as quantified by the pseudo <span class="math notranslate nohighlight">\(R^2\)</span> value of the model.
Use <code class="docutils literal notranslate"><span class="pre">get_species</span></code> to select the Chinstrap penguins, then use logistic regression to fit a logistic regression model with sex as the response variable and all four measurements as explanatory variables.
How does the pseudo <span class="math notranslate nohighlight">\(R^2\)</span> value compare to the other models?</p>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chinstrap</span> <span class="o">=</span> <span class="n">get_species</span><span class="p">(</span><span class="n">penguins</span><span class="p">,</span> <span class="s2">&quot;Chinstrap&quot;</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">chinstrap</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>68
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://allendowney.github.io/ThinkStats/index.html">Think Stats: Exploratory Data Analysis in Python, 3rd Edition</a></p>
<p>Copyright 2024 <a class="reference external" href="https://allendowney.com">Allen B. Downey</a></p>
<p>Code license: <a class="reference external" href="https://mit-license.org/">MIT License</a></p>
<p>Text license: <a class="reference external" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International</a></p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="chap10.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Least Squares</p>
      </div>
    </a>
    <a class="right-next"
       href="chap12.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Time Series Analysis</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#statsmodels">StatsModels</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#on-to-multiple-regression">On To Multiple Regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#control-variables">Control Variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nonlinear-relationships">Nonlinear Relationships</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#logistic-regression">Logistic Regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#glossary">Glossary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-11-1">Exercise 11.1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-11-2">Exercise 11.2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-11-3">Exercise 11.3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-11-4">Exercise 11.4</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Allen B. Downey
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>