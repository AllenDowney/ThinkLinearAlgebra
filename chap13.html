
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Survival analysis &#8212; Think Stats, 3rd edition</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]]}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chap13';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Analytic Methods" href="chap14.html" />
    <link rel="prev" title="Time Series Analysis" href="chap12.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">Think Stats, 3rd edition</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    Think Stats, 3rd edition
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="chap00.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap01.html">Exploratory Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap02.html">Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap03.html">Probability Mass Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap04.html">Cumulative Distribution Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap05.html">Modeling Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap06.html">Probability Density Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap07.html">Relationships between variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap08.html">Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap09.html">Hypothesis Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap10.html">Least Squares</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap11.html">Multiple Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap12.html">Time Series Analysis</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Survival analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap14.html">Analytic Methods</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/AllenDowney/ThinkStats/tree/v3" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/chap13.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Survival analysis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#survival-functions">Survival Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hazard-function">Hazard Function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#marriage-data">Marriage Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#weighted-bootstrap">Weighted Bootstrap</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-hazard-functions">Estimating Hazard Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-survival-functions">Estimating Survival Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lifelines">Lifelines</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-intervals">Confidence Intervals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#expected-remaining-lifetime">Expected Remaining Lifetime</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#glossary">Glossary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-13-1">Exercise 13.1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-13-2">Exercise 13.2</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p>The third edition of <em>Think Stats</em> is available now from <a class="reference external" href="https://bookshop.org/a/98697/9781098190255">Bookshop.org</a> and <a class="reference external" href="https://amzn.to/42lmxwu">Amazon</a> (those are affiliate links). If you are enjoying the free, online version, consider <a class="reference external" href="https://buymeacoffee.com/allendowney">buying me a coffee</a>.</p>
<section id="survival-analysis">
<h1>Survival analysis<a class="headerlink" href="#survival-analysis" title="Link to this heading">#</a></h1>
<p>Survival analysis is a way to describe how long things last.
It is often used to study human lifetimes, but it also applies to “survival” of mechanical and electronic components, or more generally to an interval in time before any kind of event – or even an interval in space.</p>
<p>We’ll start with a simple example, the lifespans of light bulbs, and then consider a more substantial example, age at first marriage and how it has changed in the United States over the last 50 years.</p>
<p><a class="reference external" href="https://colab.research.google.com/github/AllenDowney/ThinkStats/blob/v3/nb/chap13.ipynb">Click here to run this notebook on Colab</a>.</p>
<div class="cell tag_remove-print tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">os.path</span><span class="w"> </span><span class="kn">import</span> <span class="n">basename</span><span class="p">,</span> <span class="n">exists</span>


<span class="k">def</span><span class="w"> </span><span class="nf">download</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">urllib.request</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlretrieve</span>

        <span class="n">local</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloaded &quot;</span> <span class="o">+</span> <span class="n">local</span><span class="p">)</span>


<span class="n">download</span><span class="p">(</span><span class="s2">&quot;https://github.com/AllenDowney/ThinkStats/raw/v3/nb/thinkstats.py&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_remove-print tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">empiricaldist</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="o">%</span><span class="k">pip</span> install empiricaldist
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_remove-print tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">thinkstats</span><span class="w"> </span><span class="kn">import</span> <span class="n">decorate</span>
</pre></div>
</div>
</div>
</details>
</div>
<section id="survival-functions">
<h2>Survival Functions<a class="headerlink" href="#survival-functions" title="Link to this heading">#</a></h2>
<p>A fundamental concept in survival analysis is the <strong>survival function</strong>, which is the fraction of a population that survives longer than a given duration.
As a first example, we’ll compute a survival function for the lifespans of light bulbs.</p>
<p>We’ll use data from an experiment conducted in 2007.
Researchers installed 50 new light bulbs and left them on continuously.
They checked on the bulbs every 12 hours and recorded the lifespan of any that expired – and ran the experiment until all 50 bulbs expired.
Instructions for downloading the data are in the notebook for this chapter.</p>
<p>The following cell downloads the data, which is documented <a class="reference external" href="https://gist.github.com/epogrebnyak/7933e16c0ad215742c4c104be4fbdeb1">here</a>.</p>
<p>Dataset from:</p>
<p>V.J. Menon and D.C. Agrawal,  Renewal Rate of Filament Lamps: Theory and Experiment. Journal of Failure Analysis and Prevention. December 2007, p. 421, Table 2/
DOI: 10.1007/s11668-007-9074-9</p>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">download</span><span class="p">(</span>
    <span class="s2">&quot;https://gist.github.com/epogrebnyak/7933e16c0ad215742c4c104be4fbdeb1/raw/c932bc5b6aa6317770c4cbf43eb591511fec08f9/lamps.csv&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can read the data like this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;lamps.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>h</th>
      <th>f</th>
      <th>K</th>
    </tr>
    <tr>
      <th>i</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>28</th>
      <td>1812</td>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <th>29</th>
      <td>1836</td>
      <td>1</td>
      <td>3</td>
    </tr>
    <tr>
      <th>30</th>
      <td>1860</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>31</th>
      <td>1980</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>32</th>
      <td>2568</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">h</span></code> column contains lifespans in hours.
The <code class="docutils literal notranslate"><span class="pre">f</span></code> column records the number of bulbs that expired at each value of <code class="docutils literal notranslate"><span class="pre">h</span></code>.
To represent the distribution of lifespans, we’ll put these values in a <code class="docutils literal notranslate"><span class="pre">Pmf</span></code> object and normalize it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">empiricaldist</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pmf</span>

<span class="n">pmf_bulblife</span> <span class="o">=</span> <span class="n">Pmf</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;h&quot;</span><span class="p">])</span>
<span class="n">pmf_bulblife</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(50)
</pre></div>
</div>
</div>
</div>
<p>We can use <code class="docutils literal notranslate"><span class="pre">make_cdf</span></code> to compute the CDF, which indicates the fraction of bulbs that expire at or before each value of <code class="docutils literal notranslate"><span class="pre">h</span></code>.
For example, 78% of the bulbs expire at or before 1656 hours.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cdf_bulblife</span> <span class="o">=</span> <span class="n">pmf_bulblife</span><span class="o">.</span><span class="n">make_cdf</span><span class="p">()</span>
<span class="n">cdf_bulblife</span><span class="p">[</span><span class="mi">1656</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(0.7800000000000002)
</pre></div>
</div>
</div>
</div>
<p>The survival function is the fraction of bulbs that expire <em>after</em> each value of <code class="docutils literal notranslate"><span class="pre">h</span></code>, which is the complement of the CDF.
So we can compute it like this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">complementary_cdf</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cdf_bulblife</span>
<span class="n">complementary_cdf</span><span class="p">[</span><span class="mi">1656</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(0.21999999999999975)
</pre></div>
</div>
</div>
</div>
<p>22% of the bulbs expired after 1656 hours.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">empiricaldist</span></code> library provides a <code class="docutils literal notranslate"><span class="pre">Surv</span></code> object that represents a survival function, and a method called <code class="docutils literal notranslate"><span class="pre">make_surv</span></code> that makes one.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv_bulblife</span> <span class="o">=</span> <span class="n">cdf_bulblife</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span>
<span class="n">surv_bulblife</span><span class="p">[</span><span class="mi">1656</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(0.21999999999999997)
</pre></div>
</div>
</div>
</div>
<p>If we plot the CDF and the survival function, we can see that they are complementary – that is, their sum is 1 at all values of <code class="docutils literal notranslate"><span class="pre">h</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cdf_bulblife</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;CDF&quot;</span><span class="p">)</span>
<span class="n">surv_bulblife</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Survival&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Light bulb duration (hours)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Probability&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4b327fefc98d9cd63de1eb35106ee680bae03079a5a5c38df5bc0616dea4139b.png" src="_images/4b327fefc98d9cd63de1eb35106ee680bae03079a5a5c38df5bc0616dea4139b.png" />
</div>
</div>
<p>In that sense, the CDF and survival function are equivalent – if we are given either one, we can compute the other – but in the context of survival analysis it is more common to work with survival curves.
And computing a survival curve is a step toward the next important concept, the hazard function.</p>
</section>
<section id="hazard-function">
<h2>Hazard Function<a class="headerlink" href="#hazard-function" title="Link to this heading">#</a></h2>
<p>In the light bulb dataset, each value of <code class="docutils literal notranslate"><span class="pre">h</span></code> represents a 12-hour interval ending at hour <code class="docutils literal notranslate"><span class="pre">h</span></code> – which I will call “interval <code class="docutils literal notranslate"><span class="pre">h</span></code>”.
Suppose we know that a light bulb has survived up to interval <code class="docutils literal notranslate"><span class="pre">h</span></code>, and we would like to know the probability that it expires during interval <code class="docutils literal notranslate"><span class="pre">h</span></code>.
To answer this question, we can use the survival function, which indicates the fraction of bulbs that survive past interval <code class="docutils literal notranslate"><span class="pre">h</span></code>, and the PMF, which indicates the fraction that expire during interval <code class="docutils literal notranslate"><span class="pre">h</span></code>.
The sum of these is the fraction of bulbs that <em>could</em> expire during interval <code class="docutils literal notranslate"><span class="pre">h</span></code>, which are said to be “at risk”.
As an example, 26% of the bulbs were at risk during interval 1656.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">at_risk</span> <span class="o">=</span> <span class="n">pmf_bulblife</span> <span class="o">+</span> <span class="n">surv_bulblife</span>
<span class="n">at_risk</span><span class="p">[</span><span class="mi">1656</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(0.25999999999999995)
</pre></div>
</div>
</div>
</div>
<p>And 4% of all bulbs expired during interval 1656.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pmf_bulblife</span><span class="p">[</span><span class="mi">1656</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(0.04)
</pre></div>
</div>
</div>
</div>
<p>The <strong>hazard</strong> is the ratio of <code class="docutils literal notranslate"><span class="pre">pmf_bulblife</span></code> and <code class="docutils literal notranslate"><span class="pre">at_risk</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hazard</span> <span class="o">=</span> <span class="n">pmf_bulblife</span> <span class="o">/</span> <span class="n">at_risk</span>
<span class="n">hazard</span><span class="p">[</span><span class="mi">1656</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(0.15384615384615388)
</pre></div>
</div>
</div>
</div>
<p>Of all bulbs that survived up to interval 1656, about 15% expired during interval 1656.</p>
<p>Instead of computing the hazard function ourselves, we can use <code class="docutils literal notranslate"><span class="pre">empiricaldist</span></code>, which provides a <code class="docutils literal notranslate"><span class="pre">Hazard</span></code> object that represents a hazard function, and a <code class="docutils literal notranslate"><span class="pre">make_hazard</span></code> method that computes it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hazard_bulblife</span> <span class="o">=</span> <span class="n">surv_bulblife</span><span class="o">.</span><span class="n">make_hazard</span><span class="p">()</span>
<span class="n">hazard_bulblife</span><span class="p">[</span><span class="mi">1656</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(0.15384615384615397)
</pre></div>
</div>
</div>
</div>
<p>Here’s what the hazard function looks like for the light bulbs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hazard_bulblife</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Light bulb duration (hours)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Hazard&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f61318bbaf785683905ace59395cda61ef85e9d87979b031ccfd7ca23441d28e.png" src="_images/f61318bbaf785683905ace59395cda61ef85e9d87979b031ccfd7ca23441d28e.png" />
</div>
</div>
<p>We can see that the hazard is higher in some places than others, but this way of visualizing the hazard function can be misleading, especially in parts of the range where we don’t have much data.
A better alternative is to plot the <strong>cumulative hazard function</strong>, which is the cumulative sum of the hazards.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cumulative_hazard</span> <span class="o">=</span> <span class="n">hazard_bulblife</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
<span class="n">cumulative_hazard</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Light bulb duration (hours)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Cumulative hazard&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ec4d8ae4729ac6c5907db03385cc674ce8a63af523f6aafa9596f1c03d74ca02.png" src="_images/ec4d8ae4729ac6c5907db03385cc674ce8a63af523f6aafa9596f1c03d74ca02.png" />
</div>
</div>
<p>Where the probability of expiring is high, the cumulative hazard function is steep.
Where the probability of expiring is low, the cumulative hazard function is flat.
In this example, we can see that the hazard is highest between 1500 and 2000 hours.
After that, the hazard decreases – although this outcome is based on just one unusually long-lived bulb, so it might look different in another dataset.</p>
<p>Now that we have the general idea of survival and hazard functions, let’s apply them to a more substantial dataset.</p>
</section>
<section id="marriage-data">
<h2>Marriage Data<a class="headerlink" href="#marriage-data" title="Link to this heading">#</a></h2>
<p>In many countries, people are getting married later than they used to, and more people stay unmarried.
To explore these trends in the United States, we’ll use the tools of survival analysis and data from the National Survey of Family Growth (NSFG).</p>
<p>The NSFG dataset we used in previous chapters is the pregnancy file, which contains one row for each pregnancy reported by the survey respondents.
In this chapter, we’ll work with the respondent file, which contains information about the respondents themselves.</p>
<p>I have compiled responses from nine iterations of the survey, conducted between 1982 and 2019, and selected data related to marriage.
Instructions for downloading this excerpt are in the notebook for this chapter.</p>
<p>The following cell downloads the data, which is a CSV file I created that combines data from several iterations of the NSFG survey, from 1982 to 2019.</p>
<p>Details of the data preparation are in <a class="reference external" href="https://github.com/AllenDowney/MarriageNSFG/blob/master/clean_nsfg.ipynb">this notebook</a>.</p>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;marriage_nsfg_female.csv.gz&quot;</span>
<span class="n">download</span><span class="p">(</span><span class="s2">&quot;https://github.com/AllenDowney/ThinkStats/raw/v3/data/&quot;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can read the data like this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;marriage_nsfg_female.csv.gz&quot;</span><span class="p">)</span>
<span class="n">resp</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(70183, 34)
</pre></div>
</div>
</div>
</div>
<p>The excerpt includes one row for each of more than 70,000 respondents, and has the following variables related to age and marriage.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cmbirth</span></code>: The respondent’s date of birth, known for all respondents.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cmintvw</span></code>: The date the respondent was interviewed, known for all respondents.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cmmarrhx</span></code>: The date the respondent was first married, if applicable and known.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">evrmarry</span></code>: 1 if the respondent had been married prior to the date of interview, 0 otherwise.</p></li>
</ul>
<p>The first three variables are encoded in “century-months” – that is, the integer number of months since December 1899.
So century-month 1 is January 1900.</p>
<p>To explore generational changes, we’ll group respondents by their decade of birth.
We’ll use the following function, which takes a value of <code class="docutils literal notranslate"><span class="pre">cmbirth</span></code> and computes the corresponding decade of birth.
It uses the integer division operator <code class="docutils literal notranslate"><span class="pre">//</span></code> to divide by 10 and round down.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">month0</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">&quot;1899-12-31&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">decade_of_birth</span><span class="p">(</span><span class="n">cmbirth</span><span class="p">):</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">month0</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">cmbirth</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">date</span><span class="o">.</span><span class="n">year</span> <span class="o">//</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">10</span>
</pre></div>
</div>
</div>
</div>
<p>We can use this function and the <code class="docutils literal notranslate"><span class="pre">apply</span></code> method to compute each respondent’s decade of birth and assign it to a new column called <code class="docutils literal notranslate"><span class="pre">cohort</span></code>.
In this context, a <strong>cohort</strong> is a group of people with something in common – like the decade they were born – who are treated as a group for purposes of analysis.</p>
<p>The result from <code class="docutils literal notranslate"><span class="pre">value_counts</span></code> shows the number of people in each cohort.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">thinkstats</span><span class="w"> </span><span class="kn">import</span> <span class="n">value_counts</span>

<span class="n">resp</span><span class="p">[</span><span class="s2">&quot;cohort&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;cmbirth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">decade_of_birth</span><span class="p">)</span>
<span class="n">value_counts</span><span class="p">(</span><span class="n">resp</span><span class="p">[</span><span class="s2">&quot;cohort&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>cohort
1930      325
1940     3608
1950    10631
1960    14953
1970    16438
1980    14271
1990     8552
2000     1405
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>The dataset includes more than 10,000 respondents born in each decade from the 1950s to the 1980s, and fewer respondents in the earlier and later decades.</p>
<p>Next we’ll compute each respondent’s age when married (if applicable) and their age when interviewed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resp</span><span class="p">[</span><span class="s2">&quot;agemarr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">resp</span><span class="p">[</span><span class="s2">&quot;cmmarrhx&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;cmbirth&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">12</span>
<span class="n">resp</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">resp</span><span class="p">[</span><span class="s2">&quot;cmintvw&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;cmbirth&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">12</span>
</pre></div>
</div>
</div>
</div>
<p>To get started with this data, we’ll use the following function, which takes as arguments a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> and a list of cohorts, and returns a dictionary that maps from each cohort to a <code class="docutils literal notranslate"><span class="pre">Surv</span></code> object.
For each cohort, it selects their ages at first marriage and uses <code class="docutils literal notranslate"><span class="pre">Surv.from_seq</span></code> to compute a survival function.
The <code class="docutils literal notranslate"><span class="pre">dropna=False</span></code> argument includes <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values in the survival function, so the result includes people who have not married.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">empiricaldist</span><span class="w"> </span><span class="kn">import</span> <span class="n">Surv</span>


<span class="k">def</span><span class="w"> </span><span class="nf">make_survival_map</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">cohorts</span><span class="p">):</span>
    <span class="n">surv_map</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">grouped</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;cohort&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">cohort</span> <span class="ow">in</span> <span class="n">cohorts</span><span class="p">:</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">cohort</span><span class="p">)</span>
        <span class="n">surv_map</span><span class="p">[</span><span class="n">cohort</span><span class="p">]</span> <span class="o">=</span> <span class="n">Surv</span><span class="o">.</span><span class="n">from_seq</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="s2">&quot;agemarr&quot;</span><span class="p">],</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">surv_map</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s how we use this function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cohorts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1980</span><span class="p">,</span> <span class="mi">1960</span><span class="p">,</span> <span class="mi">1940</span><span class="p">]</span>
<span class="n">surv_map</span> <span class="o">=</span> <span class="n">make_survival_map</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">cohorts</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And here are the results for people born in the 1940s, 1960s, and 1980s.</p>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cycler</span>

<span class="c1"># Extract the default color cycle</span>
<span class="n">default_colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.prop_cycle&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">by_key</span><span class="p">()[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span>

<span class="c1"># Define the desired line styles</span>
<span class="n">linestyles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;-.&quot;</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;-.&quot;</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;-.&quot;</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">]</span>

<span class="c1"># Ensure we cycle through styles and colors properly</span>
<span class="n">custom_cycler</span> <span class="o">=</span> <span class="n">cycler</span><span class="o">.</span><span class="n">cycler</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">default_colors</span><span class="p">)</span> <span class="o">+</span> <span class="n">cycler</span><span class="o">.</span><span class="n">cycler</span><span class="p">(</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyles</span>
<span class="p">)</span>

<span class="c1"># Apply the new cycler</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s2">&quot;axes&quot;</span><span class="p">,</span> <span class="n">prop_cycle</span><span class="o">=</span><span class="n">custom_cycler</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">cohort</span><span class="p">,</span> <span class="n">surv</span> <span class="ow">in</span> <span class="n">surv_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">surv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cohort</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

<span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">]</span>
<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Prob never married&quot;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b721d866d71b0d0109fa767b1f35391485fc49d71d5a69b50a6874f9455433a9.png" src="_images/b721d866d71b0d0109fa767b1f35391485fc49d71d5a69b50a6874f9455433a9.png" />
</div>
</div>
<p>If we take these results at face value, they show that people in earlier generations got married younger, and more of them got married eventually.
However, we should not interpret these results yet, because they are not correct.
There are two problems we have to address:</p>
<ul class="simple">
<li><p>As discussed in <a class="reference internal" href="chap01.html#section-nsfg"><span class="std std-ref">Chapter 1</span></a>, the NSFG uses stratified sampling, which means that it deliberately oversamples some groups.</p></li>
<li><p>Also, this way of computing the survival function does not properly take into account people who are not married yet.</p></li>
</ul>
<p>For the first problem, we’ll use a kind of resampling called a <strong>weighted bootstrap</strong>.
For the second problem, we’ll use a method called Kaplan-Meier estimation.
We’ll start with resampling.</p>
</section>
<section id="weighted-bootstrap">
<h2>Weighted Bootstrap<a class="headerlink" href="#weighted-bootstrap" title="Link to this heading">#</a></h2>
<p>The NSFG dataset includes a column called <code class="docutils literal notranslate"><span class="pre">finalwgt</span></code> that contains each respondent’s sampling weight, which is the number of people in the population they represent.
We can use these weights during the resampling process to correct for stratified sampling.
The following function takes a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> and the name of the column that contains the sampling weights.
It resamples the rows of the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, taking the sampling weights into account, and returns a new <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">resample_rows_weighted</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s2">&quot;finalwgt&quot;</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The current dataset includes respondents from several iterations of the survey, called cycles, so in order to resample, we have to group the respondents by cycle, resample each group, and then put the groups back together.
That’s what the following function does.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">resample_cycles</span><span class="p">(</span><span class="n">resp</span><span class="p">):</span>
    <span class="n">grouped</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;cycle&quot;</span><span class="p">)</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">resample_rows_weighted</span><span class="p">(</span><span class="n">group</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To get started, we’ll resample the data once.</p>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Seed the random number generator so we get the same results every time</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span> <span class="o">=</span> <span class="n">resample_cycles</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Later we’ll resample the data several times, so we can see how much variation there is due to random sampling.</p>
<p>The following figure shows the results with resampling, compared to the results from the previous section without resampling, shown as dotted lines.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">surv</span> <span class="ow">in</span> <span class="n">surv_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">surv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">survs_resampled</span> <span class="o">=</span> <span class="n">make_survival_map</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">cohorts</span><span class="p">)</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">surv</span> <span class="ow">in</span> <span class="n">survs_resampled</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">surv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Prob never married&quot;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f27b6bcf8a08c708a272e059ca8a18f8e3ee91f79a43b783f5c545d56a64f9b9.png" src="_images/f27b6bcf8a08c708a272e059ca8a18f8e3ee91f79a43b783f5c545d56a64f9b9.png" />
</div>
</div>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s2">&quot;axes&quot;</span><span class="p">,</span> <span class="n">prop_cycle</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParamsDefault</span><span class="p">[</span><span class="s2">&quot;axes.prop_cycle&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>The difference, with and without resampling, is substantial, which shows that we need to correct for stratified sampling to get accurate results.</p>
<p>Now let’s get to the second problem, dealing with incomplete data.</p>
</section>
<section id="estimating-hazard-functions">
<h2>Estimating Hazard Functions<a class="headerlink" href="#estimating-hazard-functions" title="Link to this heading">#</a></h2>
<p>In the light bulb example, we know the life spans for all 50 bulbs, so we can compute the survival function directly – and we can use the survival function to compute the hazard function.</p>
<p>In the marriage example, we know the age at first marriage for some respondents, the ones who had been married before they were interviewed.
But for respondents who had never married, we don’t know at what age they would marry in the future – or if they will.</p>
<p>This kind of missing data is said to be <strong>censored</strong>.
That term might seem odd, because censored information is usually hidden deliberately, but in this case it is hidden just because we don’t know the future.</p>
<p>However, we have partial information we can work with: if someone is unmarried when they are surveyed, we know that the age when they get married (if they do) must be greater than their current age.</p>
<p>We can use this partial information to estimate the hazard function; then we can use the hazard function to compute the survival function.
This process is called <strong>Kaplan-Meier estimation</strong>.</p>
<p>To demonstrate, I’ll select just one cohort from the resampled data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resp60</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;cohort == 1960&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>For respondents who were married when they were surveyed, we’ll select their age at first marriage.
There are 9921 of them, which we’ll call “complete” cases.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">complete</span> <span class="o">=</span> <span class="n">resp60</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;evrmarry == 1&quot;</span><span class="p">)[</span><span class="s2">&quot;agemarr&quot;</span><span class="p">]</span>
<span class="n">complete</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(9921)
</pre></div>
</div>
</div>
</div>
<p>For respondents who had not married, we’ll select their age when they were surveyed.
There are 5468 of them, which we’ll call the “ongoing” cases.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ongoing</span> <span class="o">=</span> <span class="n">resp60</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;evrmarry == 0&quot;</span><span class="p">)[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span>
<span class="n">ongoing</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(5468)
</pre></div>
</div>
</div>
</div>
<p>Now, to estimate the hazard function, we’ll compute the total number of cases that were “at risk” at each age, including everyone who was unmarried up to that age.
It will be convenient to make a <code class="docutils literal notranslate"><span class="pre">FreqTab</span></code> object that counts the number of complete and ongoing cases at each age.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">empiricaldist</span><span class="w"> </span><span class="kn">import</span> <span class="n">FreqTab</span>

<span class="n">ft_complete</span> <span class="o">=</span> <span class="n">FreqTab</span><span class="o">.</span><span class="n">from_seq</span><span class="p">(</span><span class="n">complete</span><span class="p">)</span>
<span class="n">ft_ongoing</span> <span class="o">=</span> <span class="n">FreqTab</span><span class="o">.</span><span class="n">from_seq</span><span class="p">(</span><span class="n">ongoing</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>As an example, there are 58 respondents who reported that they were married for the first time at age 25.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ft_complete</span><span class="p">[</span><span class="mi">25</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(58)
</pre></div>
</div>
</div>
</div>
<p>And another 5 respondents who were surveyed at age 25 and reported that they had never married.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ft_ongoing</span><span class="p">[</span><span class="mi">25</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(5)
</pre></div>
</div>
</div>
</div>
<p>From these <code class="docutils literal notranslate"><span class="pre">FreqTab</span></code> objects, we can compute unnormalized <code class="docutils literal notranslate"><span class="pre">Surv</span></code> objects that contain the number of complete and ongoing cases that exceed each age.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv_complete</span> <span class="o">=</span> <span class="n">ft_complete</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span>
<span class="n">surv_ongoing</span> <span class="o">=</span> <span class="n">ft_ongoing</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>For example, there are 2848 people who reported getting married after age 25.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv_complete</span><span class="p">[</span><span class="mi">25</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(2848)
</pre></div>
</div>
</div>
</div>
<p>And 2273 people surveyed after age 25 who had never married.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv_ongoing</span><span class="p">[</span><span class="mi">25</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(2273)
</pre></div>
</div>
</div>
</div>
<p>The sum of the four numbers we just computed is the number of respondents who were at risk – that is, people who could have married at age 25.
The term “at risk” is a legacy of survival analysis in medicine, where it often refers to risk of disease or death.
It might seem incongruent in the context of marriage, which is generally considered a positive milestone.
That said, here’s how we compute it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">at_risk</span> <span class="o">=</span> <span class="n">ft_complete</span><span class="p">[</span><span class="mi">25</span><span class="p">]</span> <span class="o">+</span> <span class="n">ft_ongoing</span><span class="p">[</span><span class="mi">25</span><span class="p">]</span> <span class="o">+</span> <span class="n">surv_complete</span><span class="p">[</span><span class="mi">25</span><span class="p">]</span> <span class="o">+</span> <span class="n">surv_ongoing</span><span class="p">[</span><span class="mi">25</span><span class="p">]</span>
<span class="n">at_risk</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(5184)
</pre></div>
</div>
</div>
</div>
<p>Of those, the number who actually married at age 25 is <code class="docutils literal notranslate"><span class="pre">ft_complete[25]</span></code>.
So we can compute the hazard function at age 25 like this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hazard</span> <span class="o">=</span> <span class="n">ft_complete</span><span class="p">[</span><span class="mi">25</span><span class="p">]</span> <span class="o">/</span> <span class="n">at_risk</span>
<span class="n">hazard</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(0.011188271604938271)
</pre></div>
</div>
</div>
</div>
<p>That’s how we can compute the hazard function at a single age.
Now let’s compute the whole function, for all ages.
We’ll use the <code class="docutils literal notranslate"><span class="pre">union</span></code> method of the <code class="docutils literal notranslate"><span class="pre">Index</span></code> class to compute a Pandas <code class="docutils literal notranslate"><span class="pre">Index</span></code> that contains all of the ages from <code class="docutils literal notranslate"><span class="pre">ft_complete</span></code> and <code class="docutils literal notranslate"><span class="pre">ft_ongoing</span></code>, in order.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">ft_complete</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">ft_ongoing</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can compute the number of people at risk at every age, by looking up the ages in <code class="docutils literal notranslate"><span class="pre">ts</span></code> in each of the  <code class="docutils literal notranslate"><span class="pre">FreqTab</span></code> and <code class="docutils literal notranslate"><span class="pre">Surv</span></code> objects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">at_risk</span> <span class="o">=</span> <span class="n">ft_complete</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span> <span class="o">+</span> <span class="n">ft_ongoing</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span> <span class="o">+</span> <span class="n">surv_complete</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span> <span class="o">+</span> <span class="n">surv_ongoing</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, we can compute the hazard function at each age, and put the results into a <code class="docutils literal notranslate"><span class="pre">Hazard</span></code> object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">empiricaldist</span><span class="w"> </span><span class="kn">import</span> <span class="n">Hazard</span>

<span class="n">hs</span> <span class="o">=</span> <span class="n">ft_complete</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span> <span class="o">/</span> <span class="n">at_risk</span>
<span class="n">hazard</span> <span class="o">=</span> <span class="n">Hazard</span><span class="p">(</span><span class="n">hs</span><span class="p">,</span> <span class="n">ts</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s what the cumulative hazard function looks like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hazard</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Cumulative hazard&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f3552c1e500d46d488fbb5f01af5b46e9f301f33836909ddca98e1fc5578ef07.png" src="_images/f3552c1e500d46d488fbb5f01af5b46e9f301f33836909ddca98e1fc5578ef07.png" />
</div>
</div>
<p>It is steepest between ages 20 and 30, which means that an unmarried person is at the greatest “risk” of getting married at these ages.
After that, the cumulative hazard levels off, which means that the hazard gradually decreases.</p>
</section>
<section id="estimating-survival-functions">
<h2>Estimating Survival Functions<a class="headerlink" href="#estimating-survival-functions" title="Link to this heading">#</a></h2>
<p>If we are given a survival function, we know how to compute the hazard function.
Now let’s go in the other direction.</p>
<p>Here’s one way to think of it.
The hazard function indicates the probability of getting married at each age, if you have not already married.
So the complement of the hazard function is the probability of staying unmarried at each age.</p>
<p>In order to “survive” past a given age, <code class="docutils literal notranslate"><span class="pre">t</span></code>, you have to stay unmarried at every age up to and including <code class="docutils literal notranslate"><span class="pre">t</span></code>.
And the probability of doing that is the product of the complementary hazard function, which we can compute like this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">hazard</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Hazard</span></code> object has a <code class="docutils literal notranslate"><span class="pre">make_surv</span></code> method that does this computation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv</span> <span class="o">=</span> <span class="n">hazard</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s what the result looks like, compared to the previous result (dotted line), which corrected for stratified resampling, but did not handle censored data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">survs_resampled</span><span class="p">[</span><span class="mi">1960</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;resampled&quot;</span><span class="p">)</span>
<span class="n">surv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Kaplan-Meier&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Prob never married&quot;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2f32d31a1f4cedf5d0604cc266c6e2361faf81386eeac8bc51203c3229c7cffa.png" src="_images/2f32d31a1f4cedf5d0604cc266c6e2361faf81386eeac8bc51203c3229c7cffa.png" />
</div>
</div>
<p>We can see how important it is to handle censored data correctly.</p>
<p>A survival function like this was the basis of a famous magazine article in 1986 – <em>Newsweek</em> reported that a 40-year old unmarried woman was “more likely to be killed by a terrorist” than get married.
That claim was widely reported and became part of popular culture, but it was wrong then (because it was based on faulty analysis) and turned out to be even more wrong (because of cultural changes that were already in progress).
In 2006, <em>Newsweek</em> ran an another article acknowledging their error.</p>
<p>I encourage you to read more about this article, the statistics it was based on, and the reaction.
It should remind you of the ethical obligation to perform statistical analysis with care, interpret the results with appropriate skepticism, and present them to the public accurately and honestly.</p>
<p><a class="reference external" href="https://www.snopes.com/fact-check/marry-go-round/">Snopes has a good article on the topic</a>.</p>
<p>The following function encapsulates the steps of Kaplan-Meier estimation.
It takes as arguments sequences of survival times for complete and ongoing cases, and returns a <code class="docutils literal notranslate"><span class="pre">Hazard</span></code> object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">estimate_hazard</span><span class="p">(</span><span class="n">complete</span><span class="p">,</span> <span class="n">ongoing</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Kaplan-Meier estimation.&quot;&quot;&quot;</span>
    <span class="n">ft_complete</span> <span class="o">=</span> <span class="n">FreqTab</span><span class="o">.</span><span class="n">from_seq</span><span class="p">(</span><span class="n">complete</span><span class="p">)</span>
    <span class="n">ft_ongoing</span> <span class="o">=</span> <span class="n">FreqTab</span><span class="o">.</span><span class="n">from_seq</span><span class="p">(</span><span class="n">ongoing</span><span class="p">)</span>

    <span class="n">surv_complete</span> <span class="o">=</span> <span class="n">ft_complete</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span>
    <span class="n">surv_ongoing</span> <span class="o">=</span> <span class="n">ft_ongoing</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span>

    <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">ft_complete</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">ft_ongoing</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">at_risk</span> <span class="o">=</span> <span class="n">ft_complete</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span> <span class="o">+</span> <span class="n">ft_ongoing</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span> <span class="o">+</span> <span class="n">surv_complete</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span> <span class="o">+</span> <span class="n">surv_ongoing</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>

    <span class="n">hs</span> <span class="o">=</span> <span class="n">ft_complete</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span> <span class="o">/</span> <span class="n">at_risk</span>
    <span class="k">return</span> <span class="n">Hazard</span><span class="p">(</span><span class="n">hs</span><span class="p">,</span> <span class="n">ts</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And here’s a function that takes a group of respondents, extracts survival times, calls <code class="docutils literal notranslate"><span class="pre">estimate_hazard</span></code> to get the hazard function, and then computes the corresponding survival function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">estimate_survival</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Estimate the survival function.&quot;&quot;&quot;</span>
    <span class="n">complete</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;evrmarry == 1&quot;</span><span class="p">)[</span><span class="s2">&quot;agemarr&quot;</span><span class="p">]</span>
    <span class="n">ongoing</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;evrmarry == 0&quot;</span><span class="p">)[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span>
    <span class="n">hf</span> <span class="o">=</span> <span class="n">estimate_hazard</span><span class="p">(</span><span class="n">complete</span><span class="p">,</span> <span class="n">ongoing</span><span class="p">)</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">sf</span>
</pre></div>
</div>
</div>
</div>
<p>Soon we’ll use these functions to compute confidence intervals for survival functions.
But first let’s see another way to compute Kaplan-Meier estimates.</p>
</section>
<section id="lifelines">
<h2>Lifelines<a class="headerlink" href="#lifelines" title="Link to this heading">#</a></h2>
<p>A Python package called <code class="docutils literal notranslate"><span class="pre">lifelines</span></code> provides tools for survival analysis, including functions that compute Kaplan-Meier estimates.</p>
<p>The following cell installs <code class="docutils literal notranslate"><span class="pre">lifelines</span></code> if necessary.</p>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">lifelines</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="o">%</span><span class="k">pip</span> install lifelines
</pre></div>
</div>
</div>
</div>
<p>We can use it to confirm that the result in the previous section is correct.
First we’ll compute the survival function using <code class="docutils literal notranslate"><span class="pre">estimate_survival</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv</span> <span class="o">=</span> <span class="n">estimate_survival</span><span class="p">(</span><span class="n">resp60</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next we’ll compute it using <code class="docutils literal notranslate"><span class="pre">lifelines</span></code>.
First we’ll get the data into the format <code class="docutils literal notranslate"><span class="pre">lifelines</span></code> requires.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">complete</span> <span class="o">=</span> <span class="n">complete</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">durations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">complete</span><span class="p">,</span> <span class="n">ongoing</span><span class="p">])</span>
<span class="n">event_observed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">complete</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ongoing</span><span class="p">))])</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can make a <code class="docutils literal notranslate"><span class="pre">KaplanMeierFitter</span></code> object and fit the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lifelines</span><span class="w"> </span><span class="kn">import</span> <span class="n">KaplanMeierFitter</span>

<span class="n">kmf</span> <span class="o">=</span> <span class="n">KaplanMeierFitter</span><span class="p">()</span>
<span class="n">kmf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">durations</span><span class="o">=</span><span class="n">durations</span><span class="p">,</span> <span class="n">event_observed</span><span class="o">=</span><span class="n">event_observed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;lifelines.KaplanMeierFitter:&quot;KM_estimate&quot;, fitted with 15389 total observations, 5468 right-censored observations&gt;
</pre></div>
</div>
</div>
</div>
<p>After fitting the data, we can call the <code class="docutils literal notranslate"><span class="pre">plot</span></code> function to display the results, which include the estimated survival function and a confidence interval – although the confidence interval is not correct in this case because it doesn’t correct for stratified sampling.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kmf</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Prob never married&quot;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8607ce98344389d6b166680905db153438d143f4355f7ac898e0a9889e32a49e.png" src="_images/8607ce98344389d6b166680905db153438d143f4355f7ac898e0a9889e32a49e.png" />
</div>
</div>
<p>Unlike the survival function we computed, the one from <code class="docutils literal notranslate"><span class="pre">lifelines</span></code> starts from 0.
But the rest of the function is the same, within floating-point error.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="o">=</span> <span class="n">kmf</span><span class="o">.</span><span class="n">survival_function_</span><span class="p">[</span><span class="s2">&quot;KM_estimate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="n">surv</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>In the next section, we’ll use weighted resampling to compute confidence intervals that take stratified sampling into account.</p>
</section>
<section id="confidence-intervals">
<h2>Confidence Intervals<a class="headerlink" href="#confidence-intervals" title="Link to this heading">#</a></h2>
<p>The Kaplan-Meier estimate we computed is based on a single resampling of the dataset.
To get an idea of how much variation there is due to random sampling, we’ll run the analysis with several resamplings and plot the results.</p>
<p>We’ll use the following function, which takes a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> and a list of cohorts, estimates the survival function for each cohort, and returns a dictionary that maps from each integer cohort to a <code class="docutils literal notranslate"><span class="pre">Surv</span></code> object.</p>
<p>This function is identical to <code class="docutils literal notranslate"><span class="pre">make_survival_map</span></code>, except that it calls <code class="docutils literal notranslate"><span class="pre">estimate_survival</span></code>, which uses Kaplan-Meier estimation, rather than <code class="docutils literal notranslate"><span class="pre">Surv.from_seq</span></code>, which only works if there is no censored data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">estimate_survival_map</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">cohorts</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make a dictionary from cohorts to Surv objects.&quot;&quot;&quot;</span>
    <span class="n">surv_map</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">grouped</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;cohort&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">cohort</span> <span class="ow">in</span> <span class="n">cohorts</span><span class="p">:</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">cohort</span><span class="p">)</span>
        <span class="n">surv_map</span><span class="p">[</span><span class="n">cohort</span><span class="p">]</span> <span class="o">=</span> <span class="n">estimate_survival</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">surv_map</span>
</pre></div>
</div>
</div>
</div>
<p>The following loop generates 101 random resamplings of the dataset and makes a list of 101 dictionaries containing the estimated survival functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cohorts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1940</span><span class="p">,</span> <span class="mi">1950</span><span class="p">,</span> <span class="mi">1960</span><span class="p">,</span> <span class="mi">1970</span><span class="p">,</span> <span class="mi">1980</span><span class="p">,</span> <span class="mi">1990</span><span class="p">]</span>

<span class="n">surv_maps</span> <span class="o">=</span> <span class="p">[</span><span class="n">estimate_survival_map</span><span class="p">(</span><span class="n">resample_cycles</span><span class="p">(</span><span class="n">resp</span><span class="p">),</span> <span class="n">cohorts</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">101</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>To plot the results, we’ll use the following function, which takes that list of dictionaries, an integer cohort, and a color string.
It loops through the dictionaries, selects the survival function for the given cohort, and plots it with a nearly transparent line – which is one way to visualize the variability between resamplings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_cohort</span><span class="p">(</span><span class="n">surv_maps</span><span class="p">,</span> <span class="n">cohort</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot results for a single cohort.&quot;&quot;&quot;</span>
    <span class="n">survs</span> <span class="o">=</span> <span class="p">[</span><span class="n">surv_map</span><span class="p">[</span><span class="n">cohort</span><span class="p">]</span> <span class="k">for</span> <span class="n">surv_map</span> <span class="ow">in</span> <span class="n">surv_maps</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">surv</span> <span class="ow">in</span> <span class="n">survs</span><span class="p">:</span>
        <span class="n">surv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">surv</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">surv</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cohort</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here are the results for birth cohorts from the 1940s to the 1990s.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cohorts</span><span class="p">))]</span>

<span class="k">for</span> <span class="n">cohort</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cohorts</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="n">plot_cohort</span><span class="p">(</span><span class="n">surv_maps</span><span class="p">,</span> <span class="n">cohort</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>

<span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">55</span><span class="p">]</span>
<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Prob never married&quot;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/857e37c477c353c4342f6ed14a5a01fa4e82dbbdfb36b1a60c4da15dadfbb095.png" src="_images/857e37c477c353c4342f6ed14a5a01fa4e82dbbdfb36b1a60c4da15dadfbb095.png" />
</div>
</div>
<p>This visualization is good enough for exploration, but the lines look blurry and some of the labels overlap.
More work might be needed to make a publication-ready figure, but we’ll keep it simple for now.</p>
<p>Several patterns are visible:</p>
<ul class="simple">
<li><p>Women born in the 1940s married earliest – cohorts born in the 1950s and 1960s married later, but about the same fraction stayed unmarried.</p></li>
<li><p>Women born in the 1970s married later <em>and</em> stayed unmarried at higher rates than previous cohorts.</p></li>
<li><p>Cohorts born in the 1980s and 1990s are marrying even later, and are on track to stay unmarried at even higher rates – although these patterns could change in the future.</p></li>
</ul>
<p>We’ll have to wait for the next data release from the NSFG to learn more.</p>
</section>
<section id="expected-remaining-lifetime">
<h2>Expected Remaining Lifetime<a class="headerlink" href="#expected-remaining-lifetime" title="Link to this heading">#</a></h2>
<p>Given a distribution, we can compute the expected remaining lifetime as a function of elapsed time.
For example, given the distribution of pregnancy lengths, we can compute the expected time until delivery.
To demonstrate, we’ll use pregnancy data from the NSFG.</p>
<p>The following cells download the data files and install <code class="docutils literal notranslate"><span class="pre">statadict</span></code>, which we need to read the data.</p>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;https://github.com/AllenDowney/ThinkStats/raw/v3/nb/nsfg.py&quot;</span><span class="p">)</span>
<span class="n">download</span><span class="p">(</span><span class="s2">&quot;https://github.com/AllenDowney/ThinkStats/raw/v3/data/2002FemPreg.dct&quot;</span><span class="p">)</span>
<span class="n">download</span><span class="p">(</span><span class="s2">&quot;https://github.com/AllenDowney/ThinkStats/raw/v3/data/2002FemPreg.dat.gz&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">statadict</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="o">%</span><span class="k">pip</span> install statadict
</pre></div>
</div>
</div>
</div>
<p>We’ll use <code class="docutils literal notranslate"><span class="pre">get_nsfg_groups</span></code> to read the data and divide it into first babies and others.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">nsfg</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_nsfg_groups</span>

<span class="n">live</span><span class="p">,</span> <span class="n">firsts</span><span class="p">,</span> <span class="n">others</span> <span class="o">=</span> <span class="n">get_nsfg_groups</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We’ll start with a single resampling of the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span> <span class="o">=</span> <span class="n">resample_rows_weighted</span><span class="p">(</span><span class="n">live</span><span class="p">,</span> <span class="s2">&quot;finalwgt&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s the PMF of pregnancy durations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pmf_durations</span> <span class="o">=</span> <span class="n">Pmf</span><span class="o">.</span><span class="n">from_seq</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s2">&quot;prglngth&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Now suppose it’s the beginning of the 36th week of pregnancy.
Remembering that the most common pregnancy length is 39 weeks, we expect the remaining time to be 3-4 weeks.
To make that estimate more precise, we can identify the values in the distribution that equal or exceed 36 weeks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="mi">36</span>
<span class="n">is_remaining</span> <span class="o">=</span> <span class="n">pmf_durations</span><span class="o">.</span><span class="n">qs</span> <span class="o">&gt;=</span> <span class="n">t</span>
</pre></div>
</div>
</div>
</div>
<p>Next we’ll make a new <code class="docutils literal notranslate"><span class="pre">Pmf</span></code> object that contains only those values, shifted left so the current time is at 0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="o">=</span> <span class="n">pmf_durations</span><span class="o">.</span><span class="n">ps</span><span class="p">[</span><span class="n">is_remaining</span><span class="p">]</span>
<span class="n">qs</span> <span class="o">=</span> <span class="n">pmf_durations</span><span class="o">.</span><span class="n">qs</span><span class="p">[</span><span class="n">is_remaining</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span>

<span class="n">pmf_remaining</span> <span class="o">=</span> <span class="n">Pmf</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="n">qs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Because we selected a subset of the values in the <code class="docutils literal notranslate"><span class="pre">Pmf</span></code>, the probabilities no longer add up to 1, but we can normalize the <code class="docutils literal notranslate"><span class="pre">Pmf</span></code> so they do.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pmf_remaining</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(0.9155006558810669)
</pre></div>
</div>
</div>
</div>
<p>Here’s the result, which shows the distribution of remaining time at the beginning of the 36th week.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pmf_remaining</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Week 36&quot;</span><span class="p">)</span>
<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Remaining duration (weeks)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;PMF&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/40fb6b96fad202426770af9618cbf06f7e5c8c7b2625c5425e543bd2985b1737.png" src="_images/40fb6b96fad202426770af9618cbf06f7e5c8c7b2625c5425e543bd2985b1737.png" />
</div>
</div>
<p>The mean of this distribution is the expected remaining time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pmf_remaining</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(3.2145671641791043)
</pre></div>
</div>
</div>
</div>
<p>The following function encapsulates these steps and computes the distribution of remaining time for a given <code class="docutils literal notranslate"><span class="pre">Pmf</span></code> at a given time, <code class="docutils literal notranslate"><span class="pre">t</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_pmf_remaining</span><span class="p">(</span><span class="n">pmf</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Distribution of remaining time.&quot;&quot;&quot;</span>
    <span class="n">is_remaining</span> <span class="o">=</span> <span class="n">pmf</span><span class="o">.</span><span class="n">qs</span> <span class="o">&gt;=</span> <span class="n">t</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="n">pmf</span><span class="o">.</span><span class="n">ps</span><span class="p">[</span><span class="n">is_remaining</span><span class="p">]</span>
    <span class="n">qs</span> <span class="o">=</span> <span class="n">pmf</span><span class="o">.</span><span class="n">qs</span><span class="p">[</span><span class="n">is_remaining</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span>
    <span class="n">pmf_remaining</span> <span class="o">=</span> <span class="n">Pmf</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="n">qs</span><span class="p">)</span>
    <span class="n">pmf_remaining</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">pmf_remaining</span>
</pre></div>
</div>
</div>
</div>
<p>The following function takes a <code class="docutils literal notranslate"><span class="pre">Pmf</span></code> of pregnancy lengths and computes the expected remaining time at the beginning of each week from the 36th to the 43rd.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">expected_remaining</span><span class="p">(</span><span class="n">pmf</span><span class="p">):</span>
    <span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mi">44</span><span class="p">)</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
        <span class="n">pmf_remaining</span> <span class="o">=</span> <span class="n">compute_pmf_remaining</span><span class="p">(</span><span class="n">pmf</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">expected</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmf_remaining</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">expected</span>
</pre></div>
</div>
</div>
</div>
<p>Here are the results for a single resampling of the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expected</span> <span class="o">=</span> <span class="n">expected_remaining</span><span class="p">(</span><span class="n">pmf_durations</span><span class="p">)</span>
<span class="n">expected</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>36    3.214567
37    2.337714
38    1.479095
39    0.610133
40    0.912517
41    0.784211
42    0.582301
43    0.589372
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>To see how much variation there is due to random sampling, we can run this analysis with several resamplings and plot the results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">21</span><span class="p">):</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="n">resample_rows_weighted</span><span class="p">(</span><span class="n">live</span><span class="p">,</span> <span class="s2">&quot;finalwgt&quot;</span><span class="p">)</span>
    <span class="n">pmf_durations</span> <span class="o">=</span> <span class="n">Pmf</span><span class="o">.</span><span class="n">from_seq</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s2">&quot;prglngth&quot;</span><span class="p">])</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="n">expected_remaining</span><span class="p">(</span><span class="n">pmf_durations</span><span class="p">)</span>
    <span class="n">expected</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Weeks of pregnancy&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Expected remaining time (weeks)&quot;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/203affde7f36d1b69038756a0f4b3fa8945234c040f14534ffcfb3b91fc93f2c.png" src="_images/203affde7f36d1b69038756a0f4b3fa8945234c040f14534ffcfb3b91fc93f2c.png" />
</div>
</div>
<p>Between weeks 36 and 39, the expected remaining time decreases until, at the beginning of the 39th week, it is about 0.6 weeks.
But after that, the curve levels off.
At the beginning of the 40th week, the expected remaining time is still close to 0.6 weeks – actually a little higher – and at the beginning of the 41st, 42nd, and 43rd, it is almost the same.
For people waiting anxiously for a baby to be born, this behavior seems quite cruel.</p>
</section>
<section id="glossary">
<h2>Glossary<a class="headerlink" href="#glossary" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>survival analysis</strong>: A set of methods for describing and predicting the time until an event of interest, often focused on lifetimes or durations.</p></li>
<li><p><strong>survival function</strong>: A function that maps from a time, <span class="math notranslate nohighlight">\(t\)</span>, to the probability of surviving beyond <span class="math notranslate nohighlight">\(t\)</span>.</p></li>
<li><p><strong>hazard function</strong>: A function that maps from <span class="math notranslate nohighlight">\(t\)</span> to the fraction of cases that experience the event at <span class="math notranslate nohighlight">\(t\)</span>, out of all cases that survive until <span class="math notranslate nohighlight">\(t\)</span> .</p></li>
<li><p><strong>cumulative hazard function</strong>: The cumulative sum of the hazard function, often useful for visualization.</p></li>
<li><p><strong>weighted bootstrap:</strong> A form of resampling that uses sampling weights to correct for stratified sampling by simulating a representative sample.</p></li>
<li><p><strong>censored data</strong>: Data that is only partially known because the event of interest has not yet occurred or was unobserved.</p></li>
<li><p><strong>Kaplan-Meier estimation</strong>: A method for estimating survival and hazard functions in datasets with censored observations.</p></li>
<li><p><strong>cohort</strong>: A set of subjects with shared characteristics – like decade of birth – analyzed as a group.</p></li>
</ul>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<section id="exercise-13-1">
<h3>Exercise 13.1<a class="headerlink" href="#exercise-13-1" title="Link to this heading">#</a></h3>
<p>We can use the methods in this chapter to estimate hazard and survival functions for the duration of a marriage.
To keep things simple, we’ll consider only first marriages, and we’ll focus on divorce as the endpoint, rather than separation or death.</p>
<p>In the NSFG data, the <code class="docutils literal notranslate"><span class="pre">cmdivorcx</span></code> column contains the date of divorce for each respondent’s first marriage, if applicable, encoded in century-months.
Compute the duration of marriages that have ended in divorce, and the duration, so far, of marriages that are ongoing.</p>
<ul class="simple">
<li><p>For complete cases, compute the elapsed time between <code class="docutils literal notranslate"><span class="pre">cmdivorcx</span></code> and <code class="docutils literal notranslate"><span class="pre">cmmarrhx</span></code>. If both values are valid – not <code class="docutils literal notranslate"><span class="pre">NaN</span></code> – that means the respondent’s first marriage ended in divorce.</p></li>
<li><p>To identify ongoing cases, select people who have only married once and who are still married. You can use <code class="docutils literal notranslate"><span class="pre">fmarno</span></code>, which records the number of times each respondent has married, and <code class="docutils literal notranslate"><span class="pre">fmarital</span></code>, which encodes their marital status – the value 1 indicates that the respondent is married.</p></li>
</ul>
<p>In some cases the values of these variables are only approximate, so you might find a small number of negative differences, but they should not be more than one year.</p>
<p>Estimate the hazard and survival functions for the duration of marriage.
Plot the cumulative hazard function – when is the danger of divorce highest?
Plot the survival function – what fraction of marriages end in divorce?</p>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># I suggest you use a single resampling of the data</span>

<span class="n">sample</span> <span class="o">=</span> <span class="n">resample_cycles</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-13-2">
<h3>Exercise 13.2<a class="headerlink" href="#exercise-13-2" title="Link to this heading">#</a></h3>
<p>In 2012, a team of demographers at the University of Southern California estimated life expectancy for people born in Sweden in the early 1800s and 1900s.
For ages from 0 to 91 years, they estimated the age-specific mortality rate, which is the fraction of people who die at a given age, out of all who survive until that age – which you might recognize as the hazard function.</p>
<p>I used an online graph digitizer to get the data from the figure in their paper and store it in a CSV file.
Instructions for downloading the data are in the notebook for this chapter.</p>
<p>Data source: Beltrán-Sánchez, H., Crimmins, E. M., &amp; Finch, C. E. (2012). Early cohort mortality predicts the rate of aging in the cohort: a historical analysis. <em>Journal of developmental origins of health and disease</em>, 3(5), 380-386.</p>
<p>The following cell downloads the data.</p>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">download</span><span class="p">(</span>
    <span class="s2">&quot;https://github.com/AllenDowney/ThinkStats/raw/v3/data/mortality_rates_beltran2012.csv&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can load the data like this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mortality</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;mortality_rates_beltran2012.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The following function interpolates the data to make a hazard function with approximate mortality rates for each age from 0 to 99.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate</span><span class="w"> </span><span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">empiricaldist</span><span class="w"> </span><span class="kn">import</span> <span class="n">Hazard</span>


<span class="k">def</span><span class="w"> </span><span class="nf">make_hazard</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span> <span class="n">rates</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make a Hazard function by interpolating a Series.</span>

<span class="sd">    series: Series</span>

<span class="sd">    returns: Hazard</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span> <span class="n">rates</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;extrapolate&quot;</span><span class="p">)</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">interp</span><span class="p">(</span><span class="n">xs</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Hazard</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">xs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can make a <code class="docutils literal notranslate"><span class="pre">Hazard</span></code> object like this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ages</span> <span class="o">=</span> <span class="n">mortality</span><span class="p">[</span><span class="s2">&quot;1800&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">rates</span> <span class="o">=</span> <span class="n">mortality</span><span class="p">[</span><span class="s2">&quot;1800&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">hazard</span> <span class="o">=</span> <span class="n">make_hazard</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span> <span class="n">rates</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s what the mortality rates look like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hazard</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age (years)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Hazard&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/75e69939ebfeef40ace8cf9d70fb79a6e072afb77b87796a903e22639241ef19.png" src="_images/75e69939ebfeef40ace8cf9d70fb79a6e072afb77b87796a903e22639241ef19.png" />
</div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">make_surv</span></code> to make a survival function based on these rates, and <code class="docutils literal notranslate"><span class="pre">make_cdf</span></code> to compute the corresponding CDF.
Plot the results.</p>
<p>Then use <code class="docutils literal notranslate"><span class="pre">make_pmf</span></code> to make a <code class="docutils literal notranslate"><span class="pre">Pmf</span></code> object that represents the distribution of lifetimes, and plot it.
Finally, use <code class="docutils literal notranslate"><span class="pre">compute_pmf_remaining</span></code> to compute the average remaining lifetime at each age from 0 to 99.
Plot the result.</p>
<p>In the remaining lifetime curve, you should see a counterintuitive pattern – for the first few years of life, remaining lifetime increases.
Because infant mortality was so high in the early 1800s, an older child was expected to live longer than a younger child.
After about age 5, life expectancy returns to the pattern we expect – young people are expected to live longer than old people.</p>
<p>If you are interested in this topic, you might like Chapter 5 of my book, <em>Probably Overthinking It</em>, which presents similarly counterintuitive results from many areas of statistics.</p>
<p>Available from <a class="reference external" href="https://probablyoverthinking.it">https://probablyoverthinking.it</a>.</p>
<p><a class="reference external" href="https://allendowney.github.io/ThinkStats/index.html">Think Stats: Exploratory Data Analysis in Python, 3rd Edition</a></p>
<p>Copyright 2024 <a class="reference external" href="https://allendowney.com">Allen B. Downey</a></p>
<p>Code license: <a class="reference external" href="https://mit-license.org/">MIT License</a></p>
<p>Text license: <a class="reference external" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International</a></p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="chap12.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Time Series Analysis</p>
      </div>
    </a>
    <a class="right-next"
       href="chap14.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Analytic Methods</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#survival-functions">Survival Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hazard-function">Hazard Function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#marriage-data">Marriage Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#weighted-bootstrap">Weighted Bootstrap</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-hazard-functions">Estimating Hazard Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-survival-functions">Estimating Survival Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lifelines">Lifelines</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-intervals">Confidence Intervals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#expected-remaining-lifetime">Expected Remaining Lifetime</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#glossary">Glossary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-13-1">Exercise 13.1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-13-2">Exercise 13.2</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Allen B. Downey
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>